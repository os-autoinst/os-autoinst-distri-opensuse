<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>lib/sles4sap/sap_deployment_automation_framework/inventory_tools.pm</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel='stylesheet' href='../../style.css' />
</head>

<body>



<ul id="index"><li><a href="../../index.html"><i>&lt;= Back to file list</i></a></li>
  <li><a href="#SYNOPSIS">SYNOPSIS</a>
    <ul>
      <li><a href="#read_inventory_file">read_inventory_file</a></li>
      <li><a href="#ssh_config_entry_add">ssh_config_entry_add</a></li>
      <li><a href="#prepare_ssh_config">prepare_ssh_config</a></li>
      <li><a href="#verify_ssh_proxy_connection">verify_ssh_proxy_connection</a></li>
      <li><a href="#create_redirection_data">create_redirection_data</a></li>
      <li><a href="#translate_hosts_data">translate_hosts_data</a></li>
      <li><a href="#sdaf_create_instances">sdaf_create_instances</a></li>
    </ul>
  </li>
</ul><h1>lib/sles4sap/sap_deployment_automation_framework/inventory_tools.pm</h1>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<p>Library contains functions that handle SDAF inventory file.</p>

<p>SDAF inventory yaml file example: QES_DB: hosts: dbhost01: ansible_host : 192.168.1.2 ansible_user : someuser ansible_connection : ssh connection_type : key virtual_host : virtualhostname01 become_user : root os_type : linux vm_name : somevmname01 dbhost02: ansible_host : 192.168.1.3 ansible_user : someuser ansible_connection : ssh connection_type : key virtual_host : virtualhostname02 become_user : root os_type : linux vm_name : somevmname02 vars: node_tier : hana supported_tiers : [hana, scs, pas] QES_SCS: hosts: vars: node_tier : scs supported_tiers : [scs, pas] QES_ERS: hosts: vars: node_tier : ers supported_tiers : [ers]</p>

<h2 id="read_inventory_file">read_inventory_file</h2>

<pre><code>read_inventory_file($sap_inventory_file_path);</code></pre>

<p>Returns SDAF inventory file content in perl HASHREF format.</p>

<ul>

<li><p><b>inventory_file_path</b> Full file path pointing to SDAF inventory file</p>

</li>
</ul>

<h2 id="ssh_config_entry_add">ssh_config_entry_add</h2>

<pre><code>ssh_config_entry_add(entry_name=&gt;&#39;jump_host&#39;, hostname=&gt;&#39;SuperMario&#39;
    [, identity_file=&gt;&#39;/path/to/private/key&#39;,
    identities_only=&gt;1,
    user=&gt;&#39;luigi&#39;
    proxy_jump=&gt;&#39;192.168.1.100&#39;,
    strict_host_key_checking=&gt;0,
    batch_mode=&gt;1]);</code></pre>

<p>Produce ~/.ssh/config host entry like:</p>

<p>----- Host Mario_host HostName 192.2.150.85 some_hostname IdentitiesOnly yes BatchMode yes User mario_plumber IdentityFile ~/.ssh/id_rsa -----</p>

<ul>

<li><p><b>entry_name</b> Config entry name. This name can be used instead of host/IP in ssh command. Example: ssh root@&lt;entry_name&gt;</p>

</li>
<li><p><b>user</b> Define ssh username</p>

</li>
<li><p><b>hostname</b> Target hostname or IP addr</p>

</li>
<li><p><b>identity_file</b> Full path to SSH private key</p>

</li>
<li><p><b>identities_only</b> If true, SSH will only attempt passwordless login</p>

</li>
<li><p><b>batch_mode</b> If true, all SSH interactive features will be disabled. Test won&#39;t have to wait for timeouts.</p>

</li>
<li><p><b>proxy_jump</b> Jump host hostname, IP addr or point to another entry in config file</p>

</li>
<li><p><b>strict_host_key_checking</b> Turn off host key check</p>

</li>
</ul>

<h2 id="prepare_ssh_config">prepare_ssh_config</h2>

<pre><code>prepare_ssh_config(inventory_data=&gt;HASHREF, jump_host=&gt;10.10.10.10, jump_host_user=&gt;&#39;azureadm&#39;);</code></pre>

<p>Reads referenced SDAF inventory data and composes <i>~/.ssh/config</i> entry for each host. In case of SDAF you need to specify <b>jump_host</b> if you want to set this up on worker VM and access SUT via SSH proxy. For an example of an SDAF inventory data structure check <b>SYNOPSIS</b> part of this module.</p>

<ul>

<li><p><b>inventory_data</b> SDAF inventory content in referenced perl data structure.</p>

</li>
<li><p><b>jump_host_ip</b> hostname, IP address or <i>~/.ssh/config</i> entry pointing to jumphost. Keyless SSH must be working.</p>

</li>
<li><p><b>jump_host_user</b> SSH login user.</p>

</li>
</ul>

<h2 id="verify_ssh_proxy_connection">verify_ssh_proxy_connection</h2>

<pre><code>verify_ssh_proxy_connection(inventory_data=&gt;HASHREF);</code></pre>

<p>Reads parsed and referenced SDAF inventory data and executes simple <code>hostname</code> command on each SUT to verify the connection is working. A check is performed if <code>hostname</code> output is the same as target from inventory file. For an example of an SDAF inventory data structure check <b>SYNOPSIS</b> part of this module.</p>

<ul>

<li><p><b>inventory_data</b> SDAF inventory content in referenced perl data structure.</p>

</li>
</ul>

<h2 id="create_redirection_data">create_redirection_data</h2>

<pre><code>create_redirection_data(inventory_data=&gt;HASHREF);</code></pre>

<p>Reads parsed and referenced SDAF inventory data, creates data structure required for redirection based tests. Returns HASHREF. For more information about returned format check `/tests/sles4sap/redirection_tests/README.md`.</p>

<ul>

<li><p><b>inventory_data</b> SDAF inventory content in referenced perl data structure.</p>

</li>
<li><p><b>sap_sid</b> SAP system ID. Default &#39;SAP_SID&#39; OpenQA parameter.</p>

</li>
</ul>

<h2 id="translate_hosts_data">translate_hosts_data</h2>

<pre><code>translate_hosts_data(%hosts_data);</code></pre>

<p>Reads &#39;hosts&#39; SDAF inventory section and returns structure translated to hash of hosts required for console redirection tests.</p>

<ul>

<li><p><b>hosts_data</b> SDAF inventory content in referenced perl data structure.</p>

</li>
</ul>

<h2 id="sdaf_create_instances">sdaf_create_instances</h2>

<pre><code>sdaf_create_instances(inventory_content=&gt;HASHREF);</code></pre>

<p>Creates and returns <b>$instances</b> class which is a main component of <i>lib/sles4sap_publiccloud.pm</i> and general public cloud libraries <i>/lib/publiccloud/*</i>. Check SDAF inventory file example in <b>SYNOPSIS</b></p>

<ul>

<li><p><b>inventory_content</b> Referenced content of the SDAF inventory yaml file</p>

</li>
<li><p><b>sut_ssh_key_path</b> Path to private key file allowing SSH connection to SUT</p>

</li>
</ul>


</body>

</html>


