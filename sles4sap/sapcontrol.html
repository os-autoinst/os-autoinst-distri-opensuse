<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>lib/sles4sap/sapcontrol.pm</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel='stylesheet' href='../style.css' />
</head>

<body>



<ul id="index"><li><a href="../index.html"><i>&lt;= Back to file list</i></a></li>
  <li><a href="#SYNOPSIS">SYNOPSIS</a>
    <ul>
      <li><a href="#sapcontrol">sapcontrol</a></li>
      <li><a href="#sap_show_status_info">sap_show_status_info</a></li>
      <li><a href="#sapcontrol_process_check">sapcontrol_process_check</a></li>
      <li><a href="#get_remote_instance_number">get_remote_instance_number</a></li>
      <li><a href="#get_instance_type">get_instance_type</a></li>
    </ul>
  </li>
</ul><h1>lib/sles4sap/sapcontrol.pm</h1>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<p>Package containing functions which interact or are related to <code>sapcontrol</code> execution.</p>

<h2 id="sapcontrol">sapcontrol</h2>

<pre><code>sapcontrol(instance_id=&gt;&#39;00&#39;,
   webmethod=&gt;&#39;GetProcessList&#39;,
   sidadm=&gt;&#39;pooadm&#39;,
   [additional_args=&gt;&#39;someargument&#39;,
   remote_execution=&gt;$remote_execution,
   return_output=&gt;&#39;true&#39;]);</code></pre>

<p>Executes sapcontrol webmethod for instance specified in arguments and returns exit code received from command. Allows remote execution of webmethods between instances, however not all webmethods are possible to execute in that manner. Function expects to be executed from an authorized user (sidadm or root).</p>

<p>Sapcontrol return codes:</p>

<pre><code>RC 0 = webmethod call was successful
RC 1 = webmethod call failed
RC 2 = last webmethod call in progress (processes are starting/stopping)
RC 3 = all processes GREEN
RC 4 = all processes GREY (stopped)</code></pre>

<ul>

<li><p><b>instance_id</b> 2 digit instance number</p>

</li>
<li><p><b>webmethod</b> webmethod name to be executed (Ex: Stop, GetProcessList, ...)</p>

</li>
<li><p><b>additional_args</b> additional arguments to be appended at the end of command</p>

</li>
<li><p><b>return_output</b> returns output instead of RC</p>

</li>
<li><p><b>remote_hostname</b> hostname of the target instance for remote execution. Local execution does not need this.</p>

</li>
<li><p><b>sidadm_password</b> Password for sidadm user. Only required for remote execution.</p>

</li>
<li><p><b>sidadm</b> sidadm user. Only required for remote execution.</p>

</li>
</ul>

<h2 id="sap_show_status_info">sap_show_status_info</h2>

<pre><code>sap_show_status_info(cluster=&gt;1, netweaver=&gt;1);</code></pre>

<p>Prints output for standard set of commands to show info about system in various stages of the test for troubleshooting. It is possible to activate or deactivate various output sections by named args:</p>

<ul>

<li><p><b>cluster</b> - Shows cluster related outputs</p>

</li>
<li><p><b>netweaver</b> - Shows netweaver related outputs</p>

</li>
</ul>

<h2 id="sapcontrol_process_check">sapcontrol_process_check</h2>

<pre><code>sapcontrol_process_check(expected_state=&gt;expected_state,
   [instance_id=&gt;$instance_id,
   loop_sleep=&gt;$loop_sleep,
   timeout=&gt;$timeout,
   wait_for_state=&gt;$wait_for_state]);</code></pre>

<p>Runs &quot;sapcontrol -nr &lt;INST_NO&gt; -function GetProcessList&quot; via SIDadm and compares RC against expected state. Croaks if state is not correct.</p>

<p>Expected return codes are:</p>

<pre><code>RC 0 = webmethod call was successfull
RC 1 = webmethod call failed (This includes NIECONN_REFUSED status)
RC 2 = last webmethod call in progress (processes are starting/stopping)
RC 3 = all processes GREEN
RC 4 = all processes GREY (stopped)</code></pre>

<ul>

<li><p><b>expected_state</b> State that is expected (failed, started, stopped)</p>

</li>
<li><p><b>instance_id</b> Instance number - two digit number</p>

</li>
<li><p><b>loop_sleep</b> sleep time between checks - only used if &#39;wait_for_state&#39; is true</p>

</li>
<li><p><b>timeout</b> timeout for waiting for target state, after which function croaks</p>

</li>
<li><p><b>wait_for_state</b> If set to true, function will wait for expected state until success or timeout</p>

</li>
</ul>

<h2 id="get_remote_instance_number">get_remote_instance_number</h2>

<pre><code>get_instance_number(instance_type=&gt;$instance_type [instance_id=&gt;&#39;00&#39;]);</code></pre>

<p>Finds instance number from remote instance using sapcontrol &quot;GetSystemInstanceList&quot; webmethod. Local system instance number is required to execute sapcontrol though and can be supplied using openQA setting <b>INSTANCE_ID</b> or argument <b>$args{local_instance_id}</b>.</p>

<ul>

<li><p><b>instance_type</b> Instance type (ASCS, ERS) - this can be expanded to other instances</p>

</li>
<li><p><b>local_instance_id</b> SAP instance id - defaults to OpenQA setting INSTANCE_ID</p>

</li>
</ul>

<h2 id="get_instance_type">get_instance_type</h2>

<pre><code>get_instance_type(local_instance_id=&gt;&#39;00&#39;);</code></pre>

<ul>

<li><p><b>local_instance_id</b> SAP instance id - defaults to OpenQA setting INSTANCE_ID</p>

</li>
</ul>


</body>

</html>


