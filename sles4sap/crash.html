<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>lib/sles4sap/crash.pm</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel='stylesheet' href='../style.css' />
</head>

<body>



<ul id="index"><li><a href="../index.html"><i>&lt;= Back to file list</i></a></li>
  <li><a href="#SYNOPSIS">SYNOPSIS</a>
    <ul>
      <li><a href="#crash_deploy_name">crash_deploy_name</a></li>
      <li><a href="#crash_deploy_azure">crash_deploy_azure</a></li>
      <li><a href="#crash_deploy_aws">crash_deploy_aws</a></li>
      <li><a href="#crash_deploy_gcp">crash_deploy_gcp</a></li>
      <li><a href="#crush_pubip">crush_pubip</a></li>
      <li><a href="#crash_get_username">crash_get_username</a></li>
      <li><a href="#crash_get_instance">crash_get_instance</a></li>
      <li><a href="#crash_cleanup">crash_cleanup</a></li>
      <li><a href="#crash_system_ready">crash_system_ready</a></li>
      <li><a href="#crash_softrestart">crash_softrestart</a></li>
      <li><a href="#crash_wait_back">crash_wait_back</a></li>
      <li><a href="#crash_destroy_azure">crash_destroy_azure</a></li>
      <li><a href="#crash_destroy_aws">crash_destroy_aws</a></li>
      <li><a href="#crash_destroy_gcp">crash_destroy_gcp</a></li>
    </ul>
  </li>
</ul><h1>lib/sles4sap/crash.pm</h1>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<p>Library to manage cloud crash tests</p>

<h2 id="crash_deploy_name">crash_deploy_name</h2>

<pre><code>my $name = crash_deploy_name();</code></pre>

<p>Return the deploy name. Azure use it as resource group name</p>

<h2 id="crash_deploy_azure">crash_deploy_azure</h2>

<p>Run the Azure deployment for the crash test</p>

<dl>

<dt id="region---existing-resource-group"><b>region</b> - existing resource group</dt>
<dd>

</dd>
<dt id="os---existing-Load-balancer-NAME"><b>os</b> - existing Load balancer NAME</dt>
<dd>

</dd>
</dl>

<h2 id="crash_deploy_aws">crash_deploy_aws</h2>

<p>Run the AWS deployment for the crash test Returns the instance ID</p>

<dl>

<dt id="region---existing-resource-group1"><b>region</b> - existing resource group</dt>
<dd>

</dd>
<dt id="image_name---OS-image-name"><b>image_name</b> - OS image name</dt>
<dd>

</dd>
<dt id="image_owner---OS-image-owner"><b>image_owner</b> - OS image owner</dt>
<dd>

</dd>
<dt id="instance_type---Instance-type-of-the-VM"><b>instance_type</b> - Instance type of the VM</dt>
<dd>

</dd>
<dt id="ssh_pub_key---ssh-public-key-to-be-uploaded-in-the-VM"><b>ssh_pub_key</b> - ssh public key to be uploaded in the VM</dt>
<dd>

</dd>
</dl>

<h2 id="crash_deploy_gcp">crash_deploy_gcp</h2>

<p>Run the GCP deployment for the crash test</p>

<dl>

<dt id="region---GCP-region"><b>region</b> - GCP region</dt>
<dd>

</dd>
<dt id="zone---GCP-zone-e.g.-us-central1-a"><b>zone</b> - GCP zone (e.g., &#39;us-central1-a&#39;)</dt>
<dd>

</dd>
<dt id="project---GCP-project-ID"><b>project</b> - GCP project ID</dt>
<dd>

</dd>
<dt id="version---OS-version"><b>version</b> - OS version</dt>
<dd>

</dd>
<dt id="image_project---image-project-name"><b>image_project</b> - image project name</dt>
<dd>

</dd>
<dt id="machine_type---machine-type-e.g.-n1-standard-2"><b>machine_type</b> - machine type (e.g., &#39;n1-standard-2&#39;)</dt>
<dd>

</dd>
<dt id="ssh_key---ssh_key-file"><b>ssh_key</b> - ssh_key file</dt>
<dd>

</dd>
</dl>

<h2 id="crush_pubip">crush_pubip</h2>

<p>Get the deployment public IP of the VM. Die if an unsupported csp name is provided.</p>

<dl>

<dt id="provider---Cloud-provider-name-using-same-format-of-PUBLIC_CLOUD_PROVIDER-setting"><b>provider</b> - Cloud provider name using same format of PUBLIC_CLOUD_PROVIDER setting</dt>
<dd>

</dd>
<dt id="region-deployment-region"><b>region</b> deployment region</dt>
<dd>

</dd>
</dl>

<h2 id="crash_get_username">crash_get_username</h2>

<pre><code>my $username = crash_get_username(provider =&gt; &#39;GCE&#39;);</code></pre>

<p>Get the username for SSH login based on cloud provider</p>

<dl>

<dt id="provider---Cloud-provider-name-EC2-AZURE-GCE"><b>provider</b> - Cloud provider name (EC2, AZURE, GCE)</dt>
<dd>

</dd>
</dl>

<h2 id="crash_get_instance">crash_get_instance</h2>

<pre><code>my $instance = crash_get_instance(
    provider =&gt; &#39;GCE&#39;,
    region =&gt; &#39;us-central1&#39;);</code></pre>

<p>Create and return a publiccloud::instance object for the crash test VM</p>

<dl>

<dt id="provider---Cloud-provider-name-EC2-AZURE-GCE1"><b>provider</b> - Cloud provider name (EC2, AZURE, GCE)</dt>
<dd>

</dd>
<dt id="region---Cloud-region"><b>region</b> - Cloud region</dt>
<dd>

</dd>
</dl>

<h2 id="crash_cleanup">crash_cleanup</h2>

<pre><code>crash_cleanup(
    provider =&gt; &#39;GCE&#39;,
    region =&gt; &#39;us-central1&#39;);</code></pre>

<p>Clean up cloud resources for crash test</p>

<dl>

<dt id="provider---Cloud-provider-name-EC2-AZURE-GCE2"><b>provider</b> - Cloud provider name (EC2, AZURE, GCE)</dt>
<dd>

</dd>
<dt id="region---Cloud-region1"><b>region</b> - Cloud region</dt>
<dd>

</dd>
</dl>

<h2 id="crash_system_ready">crash_system_ready</h2>

<pre><code>Polls C&lt;systemctl is-system-running&gt; via SSH for up to 5 minutes.
If C&lt;reg_code&gt; is provided, registers the system and verifies with C&lt;SUSEConnect -s&gt;.</code></pre>

<dl>

<dt id="reg_code-Registration-code"><b>reg_code</b> Registration code.</dt>
<dd>

</dd>
<dt id="ssh_command-SSH-command-for-registration"><b>ssh_command</b> SSH command for registration.</dt>
<dd>

</dd>
<dt id="scc_endpoint-The-way-of-doing-registration-SUSEConnect-or-registercloudguest"><b>scc_endpoint</b> The way of doing registration, SUSEConnect or registercloudguest.</dt>
<dd>

</dd>
</dl>

<h2 id="crash_softrestart">crash_softrestart</h2>

<pre><code>crash_softrestart(instance =&gt; $instance [, timeout =&gt; 600]);</code></pre>

<p>Does a soft restart of the given <code>instance</code> by running the command <code>shutdown -r</code>.</p>

<dl>

<dt id="instance-instance-of-the-PC-class"><b>instance</b> instance of the PC class.</dt>
<dd>

</dd>
<dt id="timeout"><b>timeout</b></dt>
<dd>

</dd>
</dl>

<h2 id="crash_wait_back">crash_wait_back</h2>

<pre><code>crash_wait_back(vm_ip =&gt; &#39;1.2.3.4&#39;);</code></pre>

<p>Wait until SUT is back again polling port 22 on the given IP. Then list for failed services and die if find one.</p>

<dl>

<dt id="vm_ip-Public-IP-address-of-the-SUT-can-be-calculated-by-crash_pubip"><b>vm_ip</b> Public IP address of the SUT, can be calculated by crash_pubip</dt>
<dd>

</dd>
<dt id="username-Public-IP-address-of-the-SUT-can-be-calculated-by-crash_pubip"><b>username</b> Public IP address of the SUT, can be calculated by crash_pubip</dt>
<dd>

</dd>
</dl>

<h2 id="crash_destroy_azure">crash_destroy_azure</h2>

<p>Delete the Azure deployment</p>

<h2 id="crash_destroy_aws">crash_destroy_aws</h2>

<p>Delete the AWS deployment</p>

<dl>

<dt id="region-region-where-the-deployment-has-been-deployed-in-AWS"><b>region</b> region where the deployment has been deployed in AWS</dt>
<dd>

</dd>
</dl>

<h2 id="crash_destroy_gcp">crash_destroy_gcp</h2>

<p>Delete the GCP deployment</p>

<dl>

<dt id="zone---GCP-zone-where-the-deployment-was-created"><b>zone</b> - GCP zone where the deployment was created</dt>
<dd>

</dd>
<dt id="region---GCP-region1"><b>region</b> - GCP region</dt>
<dd>

</dd>
</dl>


</body>

</html>


