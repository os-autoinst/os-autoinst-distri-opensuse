<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>lib/sles4sap/publiccloud.pm</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel='stylesheet' href='../style.css' />
</head>

<body>



<ul id="index"><li><a href="../index.html"><i>&lt;= Back to file list</i></a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a>
    <ul>
      <li><a href="#run_cmd-run_cmd-cmd-command-runas-user-timeout-60">run_cmd run_cmd(cmd =&gt; &#39;command&#39;, [runas =&gt; &#39;user&#39;, timeout =&gt; 60]);</a></li>
      <li><a href="#run_cmd_retry-run_cmd_retry-cmd-command-retry-3-timeout-60-delay-10">run_cmd_retry run_cmd_retry(cmd =&gt; &#39;command&#39;, [retry =&gt; 3, timeout =&gt; 60, delay =&gt; 10]);</a></li>
      <li><a href="#get_promoted_hostname-get_promoted_hostname">get_promoted_hostname() get_promoted_hostname();</a></li>
      <li><a href="#deployment_cleanup">deployment_cleanup</a></li>
      <li><a href="#get_hana_topology-Parses-command-output-returns-hash-of-hashes-containing-values-for-each-host">get_hana_topology Parses command output, returns hash of hashes containing values for each host.</a></li>
      <li><a href="#is_hana_online-is_hana_online-timeout-120-wait_for_start-false">is_hana_online is_hana_online([timeout =&gt; 120, wait_for_start =&gt; &#39;false&#39;]);</a></li>
      <li><a href="#is_hana_resource_running-is_hana_resource_running-quiet-0">is_hana_resource_running is_hana_resource_running([quiet =&gt; 0]);</a></li>
      <li><a href="#is_hana_node_up-is_hana_node_up-my_instance-timeout-900">is_hana_node_up is_hana_node_up($my_instance, [timeout =&gt; 900]);</a></li>
      <li><a href="#stop_hana-stop_hana-timeout-timeout-method-method">stop_hana stop_hana([timeout =&gt; $timeout, method =&gt; $method]);</a></li>
      <li><a href="#start_hana-start_hana-timeout-60">start_hana start_hana([timeout =&gt; 60]);</a></li>
      <li><a href="#cleanup_resource-cleanup_resource-timeout-60">cleanup_resource cleanup_resource([timeout =&gt; 60]);</a></li>
      <li><a href="#check_takeover-check_takeover">check_takeover check_takeover();</a></li>
      <li><a href="#enable_replication-enable_replication-site_name-site_a-hana_inn-10">enable_replication enable_replication([site_name =&gt; &#39;site_a&#39;, hana_inn =&gt; &#39;10&#39; ]);</a></li>
      <li><a href="#get_replication_info-get_replication_info">get_replication_info get_replication_info();</a></li>
      <li><a href="#get_promoted_instance-get_promoted_instance">get_promoted_instance get_promoted_instance();</a></li>
      <li><a href="#wait_for_sync-wait_for_sync-timeout-timeout">wait_for_sync wait_for_sync([timeout =&gt; $timeout]);</a></li>
      <li><a href="#wait_for_pacemaker-wait_for_pacemaker-timeout-timeout">wait_for_pacemaker wait_for_pacemaker([timeout =&gt; $timeout]);</a></li>
      <li><a href="#change_sbd_service_timeout-self-change_sbd_service_timeout-service_timeout-30">change_sbd_service_timeout $self-&gt;change_sbd_service_timeout(service_timeout =&gt; &#39;30&#39;);</a></li>
      <li><a href="#setup_sbd_delay_publiccloud-self-setup_sbd_delay_publiccloud">setup_sbd_delay_publiccloud $self-&gt;setup_sbd_delay_publiccloud();</a></li>
      <li><a href="#sbd_delay_formula-self-sbd_delay_formula">sbd_delay_formula $self-&gt;sbd_delay_formula();</a></li>
      <li><a href="#cloud_file_content_replace-cloud_file_content_replace-filename-filename-search_pattern-search_pattern-replace_with-replace_with">cloud_file_content_replace cloud_file_content_replace(filename =&gt; $filename, search_pattern =&gt; $search_pattern, replace_with =&gt; $replace_with);</a></li>
      <li><a href="#create_instance_data">create_instance_data</a></li>
      <li><a href="#deployment_name">deployment_name</a></li>
      <li><a href="#create_ansible_playbook_list">create_ansible_playbook_list</a></li>
      <li><a href="#azure_fencing_agents_playbook_args">azure_fencing_agents_playbook_args</a></li>
      <li><a href="#get_hana_site_names">get_hana_site_names</a></li>
      <li><a href="#create_hana_vars_section">create_hana_vars_section</a></li>
      <li><a href="#display_full_status">display_full_status</a></li>
      <li><a href="#list_cluster_nodes">list_cluster_nodes</a></li>
      <li><a href="#get_hana_database_status">get_hana_database_status</a></li>
      <li><a href="#is_hana_database_online">is_hana_database_online</a></li>
      <li><a href="#is_primary_node_online">is_primary_node_online</a></li>
      <li><a href="#pacemaker_version">pacemaker_version</a></li>
      <li><a href="#saphanasr_showAttr_version">saphanasr_showAttr_version</a></li>
      <li><a href="#wait_for_cluster">wait_for_cluster</a></li>
      <li><a href="#wait_for_zypper">wait_for_zypper</a></li>
      <li><a href="#check_zypper_ref">check_zypper_ref</a></li>
      <li><a href="#wait_for_idle">wait_for_idle</a></li>
    </ul>
  </li>
</ul><h1>lib/sles4sap/publiccloud.pm</h1>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<pre><code>Package with common methods and default or constant  values for sles4sap tests in the cloud</code></pre>

<h2 id="run_cmd-run_cmd-cmd-command-runas-user-timeout-60">run_cmd run_cmd(cmd =&gt; &#39;command&#39;, [runas =&gt; &#39;user&#39;, timeout =&gt; 60]);</h2>

<pre><code>Runs a command C&lt;cmd&gt; via ssh in the given VM and log the output.
All commands are executed through C&lt;sudo&gt;.
If &#39;runas&#39; defined, command will be executed as specified user,
otherwise it will be executed as root.</code></pre>

<dl>

<dt id="cmd---command-string-to-be-executed-remotely"><b>cmd</b> - command string to be executed remotely</dt>
<dd>

</dd>
<dt id="timeout---command-execution-timeout"><b>timeout</b> - command execution timeout</dt>
<dd>

</dd>
<dt id="title---used-in-record_info"><b>title</b> - used in record_info</dt>
<dd>

</dd>
<dt id="runas---pre-pend-the-command-with-su-to-execute-it-as-specific-user"><b>runas</b> - pre-pend the command with su to execute it as specific user</dt>
<dd>

</dd>
<dt id="pass-through-all-other-arguments-supported-by-ssh_script_run"><b>...</b> - pass through all other arguments supported by ssh_script_run</dt>
<dd>

</dd>
</dl>

<h2 id="run_cmd_retry-run_cmd_retry-cmd-command-retry-3-timeout-60-delay-10">run_cmd_retry run_cmd_retry(cmd =&gt; &#39;command&#39;, [retry =&gt; 3, timeout =&gt; 60, delay =&gt; 10]);</h2>

<pre><code>Runs a command C&lt;cmd&gt; via ssh in the given VM and log the output.
If command fails or C&lt;timeout&gt; is reached, then the command will be
retried for C&lt;retry&gt; times, with C&lt;delay&gt; seconds of interval in between.</code></pre>

<dl>

<dt id="cmd---command-string-to-be-executed-remotely1"><b>cmd</b> - command string to be executed remotely</dt>
<dd>

</dd>
<dt id="timeout---command-execution-timeout1"><b>timeout</b> - command execution timeout</dt>
<dd>

</dd>
<dt id="retry---number-of-retry-attempts"><b>retry</b> - number of retry attempts</dt>
<dd>

</dd>
<dt id="delay---idle-time-between-retry-attempts"><b>delay</b> - idle time between retry attempts</dt>
<dd>

</dd>
<dt id="pass-through-all-other-arguments-supported-by-run_cmd"><b>...</b> - pass through all other arguments supported by run_cmd</dt>
<dd>

</dd>
</dl>

<h2 id="get_promoted_hostname-get_promoted_hostname">get_promoted_hostname() get_promoted_hostname();</h2>

<pre><code>Checks and returns hostname of HANA promoted node according to crm shell output.</code></pre>

<h2 id="deployment_cleanup">deployment_cleanup</h2>

<pre><code>Clean up Network peering and qesap deployment
This method does not internally die and try to execute
terraform destroy in any case.
Return 0 if no internal error.</code></pre>

<dl>

<dt id="cleanup_called---flag-to-indicate-cleanup-status"><b>cleanup_called</b> - flag to indicate cleanup status</dt>
<dd>

</dd>
<dt id="ansible_present---flag-to-indicate-ansible-has-need-executed-as-part-of-the-deployment"><b>ansible_present</b> - flag to indicate ansible has need executed as part of the deployment</dt>
<dd>

</dd>
</dl>

<h2 id="get_hana_topology-Parses-command-output-returns-hash-of-hashes-containing-values-for-each-host">get_hana_topology Parses command output, returns hash of hashes containing values for each host.</h2>

<h2 id="is_hana_online-is_hana_online-timeout-120-wait_for_start-false">is_hana_online is_hana_online([timeout =&gt; 120, wait_for_start =&gt; &#39;false&#39;]);</h2>

<pre><code>Check if hana DB is online.</code></pre>

<dl>

<dt id="wait_for_start---Define-wait_for_start-to-wait-for-DB-to-start"><b>wait_for_start</b> - Define &#39;wait_for_start&#39; to wait for DB to start.</dt>
<dd>

</dd>
<dt id="timeout---timeout-for-the-wait-of-the-online-state"><b>timeout</b> - timeout for the wait of the online state</dt>
<dd>

</dd>
</dl>

<h2 id="is_hana_resource_running-is_hana_resource_running-quiet-0">is_hana_resource_running is_hana_resource_running([quiet =&gt; 0]);</h2>

<pre><code>Checks if resource msl_SAPHanaCtl_* is running on given node.</code></pre>

<dl>

<dt id="quiet---if-set-returns-the-value-without-recording-info-default:-0"><b>quiet</b> - if set, returns the value without recording info (default: 0)</dt>
<dd>

</dd>
</dl>

<h2 id="is_hana_node_up-is_hana_node_up-my_instance-timeout-900">is_hana_node_up is_hana_node_up($my_instance, [timeout =&gt; 900]);</h2>

<pre><code>Waits until &#39;is-system-running&#39; returns successfully on the target instance.</code></pre>

<dl>

<dt id="instance---the-instance-the-test-needs-to-wait-for"><b>instance</b> - the instance the test needs to wait for</dt>
<dd>

</dd>
<dt id="timeout---how-much-time-to-wait-for-before-aborting"><b>timeout</b> - how much time to wait for before aborting</dt>
<dd>

</dd>
</dl>

<h2 id="stop_hana-stop_hana-timeout-timeout-method-method">stop_hana stop_hana([timeout =&gt; $timeout, method =&gt; $method]);</h2>

<pre><code>Stops HANA database using default or specified method.
&quot;stop&quot; - stops database using &quot;HDB stop&quot; command.
&quot;kill&quot; - kills database processes using &quot;HDB -kill&quot; command.
&quot;crash&quot; - crashes entire OS using &quot;/proc/sysrq-trigger&quot; method.</code></pre>

<dl>

<dt id="method---Allow-to-specify-a-specific-stop-method"><b>method</b> - Allow to specify a specific stop method</dt>
<dd>

</dd>
<dt id="timeout---only-used-for-stop-and-kill"><b>timeout</b> - only used for stop and kill</dt>
<dd>

</dd>
</dl>

<h2 id="start_hana-start_hana-timeout-60">start_hana start_hana([timeout =&gt; 60]);</h2>

<pre><code>Start HANA DB using &quot;HDB start&quot; command</code></pre>

<h2 id="cleanup_resource-cleanup_resource-timeout-60">cleanup_resource cleanup_resource([timeout =&gt; 60]);</h2>

<pre><code>Cleanup resource &#39;msl_SAPHanaCtl_*&#39;, wait for DB start automatically.</code></pre>

<dl>

<dt id="timeout---timeout-for-waiting-resource-to-start"><b>timeout</b> - timeout for waiting resource to start</dt>
<dd>

</dd>
</dl>

<h2 id="check_takeover-check_takeover">check_takeover check_takeover();</h2>

<pre><code>Checks takeover status and waits for finish until successful or reaches timeout.</code></pre>

<h2 id="enable_replication-enable_replication-site_name-site_a-hana_inn-10">enable_replication enable_replication([site_name =&gt; &#39;site_a&#39;, hana_inn =&gt; &#39;10&#39; ]);</h2>

<pre><code>Re-enables replication on the previously fenced database node. Database must be offline.
Dies if the the given &lt;site name&gt; doesn&#39;t correspond with the SAPHanaSR topology local site name
Optionaly the &#39;hana_innstance_id&#39; could be provided for better reliability</code></pre>

<dl>

<dt id="site_name---local-HANA-site-name-of-the-site-to-be-registered"><b>site_name</b> - local HANA site name of the site to be registered</dt>
<dd>

</dd>
<dt id="hana_inn---optional-HANA-instance-number-to-be-registered"><b>hana_inn</b> - optional HANA instance number to be registered</dt>
<dd>

</dd>
</dl>

<h2 id="get_replication_info-get_replication_info">get_replication_info get_replication_info();</h2>

<pre><code>Parses &quot;hdbnsutil -sr_state&quot; command output.
Returns hash of found values converted to lowercase and replaces spaces to underscores.</code></pre>

<h2 id="get_promoted_instance-get_promoted_instance">get_promoted_instance get_promoted_instance();</h2>

<pre><code>Retrieves hostname from currently promoted (Master) database and returns instance data from $self-&gt;{instances}.</code></pre>

<h2 id="wait_for_sync-wait_for_sync-timeout-timeout">wait_for_sync wait_for_sync([timeout =&gt; $timeout]);</h2>

<pre><code>Wait for replica site to sync data with primary.
Checks &quot;SAPHanaSR-showAttr&quot; output and ensures replica site has &quot;sync_state&quot; &quot;SOK &amp;&amp; PRIM&quot; and no SFAIL.
 Continue after expected output matched N times continually to make sure cluster is synced.

Expected conditions:
 - Both primary and replica must be online.
 - primary must have sync_state &#39;PRIM&#39;
 - primary must have clone_state &#39;PROMOTED&#39;
 - replica must have sync_state &#39;SOK&#39;  - this means data is in sync
 - replica must have clone_state &#39;DEMOTED&#39;
 - site order does not matter</code></pre>

<dl>

<dt id="timeout---timeout-for-waiting-sync-state"><b>timeout</b> - timeout for waiting sync state</dt>
<dd>

</dd>
</dl>

<h2 id="wait_for_pacemaker-wait_for_pacemaker-timeout-timeout">wait_for_pacemaker wait_for_pacemaker([timeout =&gt; $timeout]);</h2>

<pre><code>Checks status of pacemaker via systemd &#39;is-active&#39; command an waits for startup.</code></pre>

<dl>

<dt id="timeout---timeout-for-waiting-for-pacemaker-service"><b>timeout</b> - timeout for waiting for pacemaker service</dt>
<dd>

</dd>
</dl>

<h2 id="change_sbd_service_timeout-self-change_sbd_service_timeout-service_timeout-30">change_sbd_service_timeout $self-&gt;change_sbd_service_timeout(service_timeout =&gt; &#39;30&#39;);</h2>

<pre><code>Overrides timeout for sbd systemd service to a value provided by argument.
This is done by creating or changing file &quot;/etc/systemd/system/sbd.service.d/sbd_delay_start.conf&quot;</code></pre>

<dl>

<dt id="service_timeout---value-for-the-TimeoutSec-setting"><b>service_timeout</b> - value for the TimeoutSec setting</dt>
<dd>

</dd>
</dl>

<h2 id="setup_sbd_delay_publiccloud-self-setup_sbd_delay_publiccloud">setup_sbd_delay_publiccloud $self-&gt;setup_sbd_delay_publiccloud();</h2>

<pre><code>Set (activate or deactivate) SBD_DELAY_START setting in /etc/sysconfig/sbd.
Delay is used in case of cluster VM joining cluster too quickly after fencing operation.
For more information check sbd man page.

Setting is changed via OpenQA parameter: HA_SBD_START_DELAY
Possible values:
&quot;no&quot; - do not set and turn off SBD delay time
&quot;yes&quot; - sets default SBD value which is calculated from a formula
&quot;&lt;number of seconds&gt;&quot; - sets specific delay in seconds

Returns integer representing wait time.</code></pre>

<h2 id="sbd_delay_formula-self-sbd_delay_formula">sbd_delay_formula $self-&gt;sbd_delay_formula();</h2>

<pre><code>return calculated sbd delay</code></pre>

<h2 id="cloud_file_content_replace-cloud_file_content_replace-filename-filename-search_pattern-search_pattern-replace_with-replace_with">cloud_file_content_replace cloud_file_content_replace(filename =&gt; $filename, search_pattern =&gt; $search_pattern, replace_with =&gt; $replace_with);</h2>

<pre><code>Replaces file content direct on PC SUT. Similar to lib/utils.pm file_content_replace()</code></pre>

<dl>

<dt id="filename---file-location"><b>filename</b> - file location</dt>
<dd>

</dd>
<dt id="search_pattern---search-pattern"><b>search_pattern</b> - search pattern</dt>
<dd>

</dd>
<dt id="replace_with---string-to-replace"><b>replace_with</b> - string to replace</dt>
<dd>

</dd>
</dl>

<h2 id="create_instance_data">create_instance_data</h2>

<pre><code>Create and populate a list of publiccloud::instance and publiccloud::provider compatible
class instances.</code></pre>

<dl>

<dt id="provider---Instance-of-PC-object-provider-the-one-usually-created-by-provider_factory"><b>provider</b> - Instance of PC object &quot;provider&quot;, the one usually created by provider_factory()</dt>
<dd>

</dd>
</dl>

<h2 id="deployment_name">deployment_name</h2>

<pre><code>Return a string to be used as value for the deployment_name variable
in the qe-sap-deployment.</code></pre>

<h2 id="create_ansible_playbook_list">create_ansible_playbook_list</h2>

<pre><code>Detects HANA/HA scenario from function arguments and returns a list of ansible playbooks to include
in the &quot;ansible: create:&quot; section of config.yaml file.</code></pre>

<dl>

<dt id="ha_enabled---Enable-the-installation-of-HANA-and-the-cluster-configuration"><b>ha_enabled</b> - Enable the installation of HANA and the cluster configuration</dt>
<dd>

</dd>
<dt id="registration---select-registration-mode-possible-values-are-registercloudguest-default-suseconnect-noreg-skip-scheduling-of-register.yaml-at-all"><b>registration</b> - select registration mode, possible values are * registercloudguest (default) * suseconnect * noreg skip scheduling of register.yaml at all</dt>
<dd>

</dd>
<dt id="scc_code---registration-code"><b>scc_code</b> - registration code</dt>
<dd>

</dd>
<dt id="ltss---name-and-reg_code-for-LTSS-extension-to-register.-This-argument-is-a-two-element-comma-separated-list-string.-Like:-SLES-LTSS-Extended-Security-12.5-x86_64-123456789-First-string-before-the-comma-has-to-be-a-valid-SCC-extension-name-later-used-by-Ansible-as-argument-for-SUSEConnect-or-registercloudguest-argument.-Second-string-has-to-be-valid-registration-code-for-the-particular-LTSS-extension"><b>ltss</b> - name and reg_code for LTSS extension to register. This argument is a two element comma separated list string. Like: &#39;SLES-LTSS-Extended-Security/12.5/x86_64,123456789&#39; First string before the comma has to be a valid SCC extension name, later used by Ansible as argument for SUSEConnect or registercloudguest argument. Second string has to be valid registration code for the particular LTSS extension.</dt>
<dd>

</dd>
<dt id="fencing---select-fencing-mechanism"><b>fencing</b> - select fencing mechanism</dt>
<dd>

</dd>
<dt id="fence_type---select-Azure-native-fencing-mechanism.-Only-two-accepted-values-spn-or-msi.-This-argument-is-only-applicable-to-Azure.-optional"><b>fence_type</b> - select Azure native fencing mechanism. Only two accepted values &#39;spn&#39; or &#39;msi&#39;. This argument is only applicable to Azure. (optional)</dt>
<dd>

</dd>
<dt id="spn_application_id---Application-ID-for-the-SPN-Azure-native-fencing-agent.This-argument-is-only-applicable-to-Azure-configured-with-native-fencing-of-type-SPN.-optional"><b>spn_application_id</b> - Application ID for the SPN Azure native fencing agent.This argument is only applicable to Azure configured with native fencing of type SPN. (optional)</dt>
<dd>

</dd>
<dt id="spn_application_password---password-for-the-SPN-Azure-native-fencing-agent.This-argument-is-only-applicable-to-Azure-configured-with-native-fencing-of-type-SPN.-optional"><b>spn_application_password</b> - password for the SPN Azure native fencing agent.This argument is only applicable to Azure configured with native fencing of type SPN. (optional)</dt>
<dd>

</dd>
<dt id="ptf_files---list-of-PTF-files-optional"><b>ptf_files</b> - list of PTF files (optional)</dt>
<dd>

</dd>
<dt id="ptf_token---SAS-token-to-access-the-PTF-files-optional"><b>ptf_token</b> - SAS token to access the PTF files (optional)</dt>
<dd>

</dd>
<dt id="ptf_account---name-of-the-account-for-the-ptf-container-optional"><b>ptf_account</b> - name of the account for the ptf container (optional)</dt>
<dd>

</dd>
<dt id="ptf_container---name-of-the-container-for-PTF-files-optional"><b>ptf_container</b> - name of the container for PTF files (optional)</dt>
<dd>

</dd>
<dt id="ibsm_ip---IP-address-of-the-IBS-Mirror-optional"><b>ibsm_ip</b> - IP address of the IBS Mirror (optional)</dt>
<dd>

</dd>
<dt id="download_hostname---hostname-associated-to-the-IBS-Mirror-IP-address-on-each-hana-node-optional"><b>download_hostname</b> - hostname associated to the IBS Mirror IP address on each hana node (optional)</dt>
<dd>

</dd>
<dt id="repos---comma-separated-list-of-repos-optional"><b>repos</b> - comma separated list of repos (optional)</dt>
<dd>

</dd>
</dl>

<h2 id="azure_fencing_agents_playbook_args">azure_fencing_agents_playbook_args</h2>

<pre><code>azure_fencing_agents_playbook_args(
    fence_type =&gt; &#39;spn&#39;
    spn_application_id=&gt;$spn_application_id,
    spn_application_password=&gt;$spn_application_password
);

Collects data and creates string of arguments that can be supplied to playbook.</code></pre>

<dl>

<dt id="FENCE_TYPE---Azure-native-fence-type-spn-msi"><b>FENCE_TYPE</b> - Azure native fence type (spn|msi)</dt>
<dd>

</dd>
<dt id="SPN_APPLICATION_ID---application-ID-that-allows-API-access-for-STONITH-device"><b>SPN_APPLICATION_ID</b> - application ID that allows API access for STONITH device</dt>
<dd>

</dd>
<dt id="SPN_APPLICATION_PASSWORD---password-provided-for-application-ID-above"><b>SPN_APPLICATION_PASSWORD</b> - password provided for application ID above</dt>
<dd>

</dd>
</dl>

<h2 id="get_hana_site_names">get_hana_site_names</h2>

<pre><code>Get primary and secondary site name.
This information is both needed to configure the qe-sap-deployment
and later in the test when calling `hdbnsutil -sr_register`.
This function mostly read the information from job settings
HANA_PRIMARY_SITE and HANA_SECONDARY_SITE, so main reason to have
it behind a function is to have coherent defaults.</code></pre>

<h2 id="create_hana_vars_section">create_hana_vars_section</h2>

<pre><code>Detects HANA/HA scenario from openQA variables and create
data later used for &quot;ansible: hana_vars:&quot; section in config.yaml file.</code></pre>

<h2 id="display_full_status">display_full_status</h2>

<pre><code>$self-&gt;display_full_status()

Displays most useful debugging info about cluster status, database status within a &#39;record_info&#39; test entry.</code></pre>

<h2 id="list_cluster_nodes">list_cluster_nodes</h2>

<pre><code>$self-&gt;list_cluster_nodes()

Returns list of hostnames that are part of a cluster using crm shell command from one of the cluster nodes.</code></pre>

<h2 id="get_hana_database_status">get_hana_database_status</h2>

<pre><code>Run a query to the hana database, parses &quot;hdbsql&quot; command output and check if the connection still is alive.
Returns 1 if the response from hana database is online, 0 otherwise</code></pre>

<dl>

<dt id="password_db---password"><b>password_db</b> - password</dt>
<dd>

</dd>
<dt id="instance_id---instance-id"><b>instance_id</b> - instance id</dt>
<dd>

</dd>
</dl>

<h2 id="is_hana_database_online">is_hana_database_online</h2>

<pre><code>Setup a timeout and check the hana database status is offline and there is not connection.
If the connection still is online run a wait and try again to get the status.
Returns 1 if the output of the hana database is online, 0 means that hana database is offline</code></pre>

<dl>

<dt id="timeout---default-900"><b>timeout</b> - default 900</dt>
<dd>

</dd>
<dt id="total_consecutive_passes---default-5"><b>total_consecutive_passes</b> - default 5</dt>
<dd>

</dd>
</dl>

<h2 id="is_primary_node_online">is_primary_node_online</h2>

<pre><code>Check if primary node in a hana cluster is offline.
Returns if primary node status is offline with 0 and 1 online</code></pre>

<dl>

<dt id="timeout---default-300"><b>timeout</b> - default 300</dt>
<dd>

</dd>
</dl>

<h2 id="pacemaker_version">pacemaker_version</h2>

<pre><code>Returns the pacemaker version</code></pre>

<h2 id="saphanasr_showAttr_version">saphanasr_showAttr_version</h2>

<pre><code>Returns the SAPHanaSR-showattr version</code></pre>

<h2 id="wait_for_cluster">wait_for_cluster</h2>

<pre><code>Verifies that nodes are online, resources are started and DB is in sync</code></pre>

<dl>

<dt id="wait_time---time-to-wait-before-retry-in-seconds-default-10"><b>wait_time</b> - time to wait before retry in seconds, default 10</dt>
<dd>

</dd>
<dt id="max_retries---maximum-number-of-retries-default-7"><b>max_retries</b> - maximum number of retries, default 7</dt>
<dd>

</dd>
</dl>

<h2 id="wait_for_zypper">wait_for_zypper</h2>

<pre><code>The function attempts to run &#39;zypper ref&#39; to check for a lock. If Zypper is locked, it waits for a specified delay before retrying.
Returns normally if Zypper is not locked or dies after a maximum number of retries if Zypper remains locked.</code></pre>

<dl>

<dt id="instance---The-instance-object-on-which-the-Zypper-command-is-executed.-This-object-must-have-the-ssh_script_run-method-implemented"><b>$instance</b> - The instance object on which the Zypper command is executed. This object must have the ssh_script_run method implemented.</dt>
<dd>

</dd>
<dt id="max_retries---The-maximum-number-of-times-the-function-will-retry-checking-if-Zypper-is-locked.-Default-is-10"><b>max_retries</b> - The maximum number of times the function will retry checking if Zypper is locked. Default is 10.</dt>
<dd>

</dd>
<dt id="retry_delay---The-number-of-seconds-to-wait-between-retries.-Default-is-20-seconds"><b>retry_delay</b> - The number of seconds to wait between retries. Default is 20 seconds.</dt>
<dd>

</dd>
<dt id="timeout---The-number-of-seconds-to-wait-before-aborting-zypper-ref-ssh_script_run-item-runas---If-runas-defined-command-will-be-executed-as-specified-user-otherwise-it-will-be-executed-as-cloudadmin"><b>timeout</b> - The number of seconds to wait before aborting zypper ref ssh_script_run =item <b>runas</b> - If &#39;runas&#39; defined, command will be executed as specified user, otherwise it will be executed as cloudadmin.</dt>
<dd>

</dd>
</dl>

<h2 id="check_zypper_ref">check_zypper_ref</h2>

<pre><code>The function attempts to run &#39;zypper ref&#39; and check for errors related to repositories.</code></pre>

<dl>

<dt id="instance---The-instance-object-on-which-the-Zypper-command-is-executed.-This-object-must-have-the-ssh_script_run-method-implemented1"><b>$instance</b> - The instance object on which the Zypper command is executed. This object must have the ssh_script_run method implemented.</dt>
<dd>

</dd>
<dt id="runas---If-runas-defined-command-will-be-executed-as-specified-user-otherwise-it-will-be-executed-as-cloudadmin"><b>runas</b> - If &#39;runas&#39; defined, command will be executed as specified user, otherwise it will be executed as cloudadmin.</dt>
<dd>

</dd>
</dl>

<h2 id="wait_for_idle">wait_for_idle</h2>

<pre><code>The function wraps the `cs_wait_for_idle` command, and restarts in case of timeout (once, this
time fatal) after displaying cluster information.</code></pre>

<dl>

<dt id="timeout---The-timeout-in-seconds-for-the-command"><b>$timeout</b> - The timeout (in seconds) for the command.</dt>
<dd>

</dd>
</dl>


</body>

</html>


