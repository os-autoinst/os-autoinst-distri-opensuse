<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>lib/sles4sap/aws_cli.pm</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel='stylesheet' href='../style.css' />
</head>

<body>



<ul id="index"><li><a href="../index.html"><i>&lt;= Back to file list</i></a></li>
  <li><a href="#SYNOPSIS">SYNOPSIS</a>
    <ul>
      <li><a href="#aws_vpc_create">aws_vpc_create</a></li>
      <li><a href="#aws_vpc_get_id">aws_vpc_get_id</a></li>
      <li><a href="#aws_vpc_delete">aws_vpc_delete</a></li>
      <li><a href="#aws_security_group_create">aws_security_group_create</a></li>
      <li><a href="#aws_security_group_delete">aws_security_group_delete</a></li>
      <li><a href="#aws_security_group_get_id">aws_security_group_get_id</a></li>
      <li><a href="#aws_security_group_authorize_ingress">aws_security_group_authorize_ingress</a></li>
      <li><a href="#aws_subnet_create">aws_subnet_create</a></li>
      <li><a href="#aws_subnet_get_id">aws_subnet_get_id</a></li>
      <li><a href="#aws_subnet_delete">aws_subnet_delete</a></li>
      <li><a href="#aws_internet_gateway_create">aws_internet_gateway_create</a></li>
      <li><a href="#aws_internet_gateway_get_id">aws_internet_gateway_get_id</a></li>
      <li><a href="#aws_internet_gateway_attach">aws_internet_gateway_attach</a></li>
      <li><a href="#aws_internet_gateway_delete">aws_internet_gateway_delete</a></li>
      <li><a href="#aws_route_table_create">aws_route_table_create</a></li>
      <li><a href="#aws_route_table_associate">aws_route_table_associate</a></li>
      <li><a href="#aws_route_table_delete">aws_route_table_delete</a></li>
      <li><a href="#aws_route_create">aws_route_create</a></li>
      <li><a href="#aws_vm_create">aws_vm_create</a></li>
      <li><a href="#aws_vm_get_id">aws_vm_get_id</a></li>
      <li><a href="#aws_vm_wait_status_ok">aws_vm_wait_status_ok</a></li>
      <li><a href="#aws_get_ip_address">aws_get_ip_address</a></li>
      <li><a href="#aws_vm_terminate">aws_vm_terminate</a></li>
      <li><a href="#aws_ssh_key_pair_import">aws_ssh_key_pair_import</a></li>
    </ul>
  </li>
</ul><h1>lib/sles4sap/aws_cli.pm</h1>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<p>Library to compose and run AWS cli commands.</p>

<h2 id="aws_vpc_create">aws_vpc_create</h2>

<pre><code>my $vpc_id = aws_vpc_create(
    region =&gt; &#39;us-west&#39;,
    cidr =&gt; &#39;1.2.3/18&#39;,
    job_id =&gt; &#39;abc123456&#39;);</code></pre>

<p>Create a new AWS VPC with a specified CIDR block and tag it with the OpenQA job ID Returns the VPC ID</p>

<dl>

<dt id="region---AWS-region-where-to-create-the-VPC"><b>region</b> - AWS region where to create the VPC</dt>
<dd>

</dd>
<dt id="cidr---CIDR-block-for-the-VPC-e.g.-10.0.0.0-16"><b>cidr</b> - CIDR block for the VPC (e.g., &#39;10.0.0.0/16&#39;)</dt>
<dd>

</dd>
<dt id="job_id---OpenQA-job-identifier-for-tagging"><b>job_id</b> - OpenQA job identifier for tagging</dt>
<dd>

</dd>
</dl>

<h2 id="aws_vpc_get_id">aws_vpc_get_id</h2>

<pre><code>my $vpc_id = aws_vpc_get_id(
    region =&gt; &#39;us-west&#39;,
    job_id =&gt; &#39;abc123456&#39;);</code></pre>

<p>Retrieve the VPC ID associated with a specific OpenQA job Returns the VPC ID</p>

<dl>

<dt id="region---AWS-region-where-the-VPC-is-located"><b>region</b> - AWS region where the VPC is located</dt>
<dd>

</dd>
<dt id="job_id---OpenQA-job-identifier-used-to-tag-the-VPC"><b>job_id</b> - OpenQA job identifier used to tag the VPC</dt>
<dd>

</dd>
</dl>

<h2 id="aws_vpc_delete">aws_vpc_delete</h2>

<pre><code>my $ret = aws_vpc_delete(
    region =&gt; &#39;us-west&#39;,
    vpc_id =&gt; &#39;vpc-456&#39;);</code></pre>

<p>Delete the VPC, do not assert but return the exit code of the command.</p>

<dl>

<dt id="region---AWS-region-where-the-VPC-is-located1"><b>region</b> - AWS region where the VPC is located</dt>
<dd>

</dd>
<dt id="vpc_id---ID-of-the-VPC-to-delete"><b>vpc_id</b> - ID of the VPC to delete</dt>
<dd>

</dd>
</dl>

<h2 id="aws_security_group_create">aws_security_group_create</h2>

<pre><code>my $sg_id = aws_security_group_create(
    region =&gt; &#39;uswest&#39;,
    group_name =&gt; &#39;something&#39;,
    description =&gt; &#39;be or not to be&#39;,
    vpc_id =&gt; &#39;vpc123456&#39;,
    job_is =&gt; &#39;7890&#39;);</code></pre>

<p>Create an AWS security group within a VPC and tag it with the OpenQA job ID</p>

<p>Returns the security group ID</p>

<dl>

<dt id="region---AWS-region-where-to-create-the-security-group"><b>region</b> - AWS region where to create the security group</dt>
<dd>

</dd>
<dt id="group_name---name-for-the-security-group"><b>group_name</b> - name for the security group</dt>
<dd>

</dd>
<dt id="description---description-of-the-security-group-purpose"><b>description</b> - description of the security group purpose</dt>
<dd>

</dd>
<dt id="vpc_id---ID-of-the-VPC-where-the-security-group-will-be-created"><b>vpc_id</b> - ID of the VPC where the security group will be created</dt>
<dd>

</dd>
<dt id="job_id---OpenQA-job-identifier-used-to-tag-the-VPC1"><b>job_id</b> - OpenQA job identifier used to tag the VPC</dt>
<dd>

</dd>
</dl>

<h2 id="aws_security_group_delete">aws_security_group_delete</h2>

<pre><code>my $ret = aws_security_group_delete(
    region =&gt; &#39;uswest&#39;,
    group_name =&gt; &#39;something&#39;,
    description =&gt; &#39;be or not to be&#39;,
    vpc_id =&gt; &#39;vpc123456&#39;,
    job_is =&gt; &#39;7890&#39;);</code></pre>

<p>Delete the security group, do not assert but return the exit code of the command.</p>

<dl>

<dt id="region---AWS-region-where-to-create-the-security-group1"><b>region</b> - AWS region where to create the security group</dt>
<dd>

</dd>
<dt id="job_id---OpenQA-job-identifier-used-to-tag-the-VPC2"><b>job_id</b> - OpenQA job identifier used to tag the VPC</dt>
<dd>

</dd>
</dl>

<h2 id="aws_security_group_get_id">aws_security_group_get_id</h2>

<pre><code>my $sg_id = aws_security_group_get_id(region =&gt; &#39;europe&#39;, job_id =&gt; &#39;12345&#39;);</code></pre>

<p>Retrieve the security group ID associated with a specific OpenQA job Returns the security group ID</p>

<dl>

<dt id="region---AWS-region-where-the-security-group-is-located"><b>region</b> - AWS region where the security group is located</dt>
<dd>

</dd>
<dt id="job_id---OpenQA-job-identifier-used-to-tag-the-security-group"><b>job_id</b> - OpenQA job identifier used to tag the security group</dt>
<dd>

</dd>
</dl>

<h2 id="aws_security_group_authorize_ingress">aws_security_group_authorize_ingress</h2>

<pre><code>aws_security_group_authorize_ingress(
    sg_id =&gt; ,
    protocol =&gt; ,
    port =&gt;,
    cidr =&gt;,
    region =&gt; );</code></pre>

<p>Add an ingress rule to a security group allowing traffic from a specific CIDR block</p>

<dl>

<dt id="sg_id---ID-of-the-security-group-to-modify"><b>sg_id</b> - ID of the security group to modify</dt>
<dd>

</dd>
<dt id="protocol---protocol-for-the-rule-e.g.-tcp-udp-icmp"><b>protocol</b> - protocol for the rule (e.g., &#39;tcp&#39;, &#39;udp&#39;, &#39;icmp&#39;)</dt>
<dd>

</dd>
<dt id="port---port-number-or-port-range-for-the-rule"><b>port</b> - port number or port range for the rule</dt>
<dd>

</dd>
<dt id="cidr---CIDR-block-allowed-to-access-e.g.-0.0.0.0-0-for-all"><b>cidr</b> - CIDR block allowed to access (e.g., &#39;0.0.0.0/0&#39; for all)</dt>
<dd>

</dd>
<dt id="region---AWS-region-where-the-security-group-is-located1"><b>region</b> - AWS region where the security group is located</dt>
<dd>

</dd>
</dl>

<h2 id="aws_subnet_create">aws_subnet_create</h2>

<pre><code>my $subnet_id = aws_subnet_create(
    region =&gt; &#39;us-west-1&#39;,
    cidr =&gt; &#39;10.0.1.0/24&#39;,
    vpc_id =&gt; &#39;vpc-12345&#39;,
    job_id =&gt; &#39;67890&#39;
);</code></pre>

<p>Create a subnet within a VPC with a specified CIDR block and tag it with the OpenQA job ID Returns the subnet ID</p>

<dl>

<dt id="region---AWS-region-where-to-create-the-subnet"><b>region</b> - AWS region where to create the subnet</dt>
<dd>

</dd>
<dt id="cidr---CIDR-block-for-the-subnet-e.g.-10.0.1.0-24"><b>cidr</b> - CIDR block for the subnet (e.g., &#39;10.0.1.0/24&#39;)</dt>
<dd>

</dd>
<dt id="vpc_id---ID-of-the-VPC-where-the-subnet-will-be-created"><b>vpc_id</b> - ID of the VPC where the subnet will be created</dt>
<dd>

</dd>
<dt id="job_id---OpenQA-job-identifier-used-to-tag-the-security-group1"><b>job_id</b> - OpenQA job identifier used to tag the security group</dt>
<dd>

</dd>
</dl>

<h2 id="aws_subnet_get_id">aws_subnet_get_id</h2>

<pre><code>my $subnet_id = aws_subnet_get_id(
    region =&gt; &#39;us-west-1&#39;,
    job_id =&gt; &#39;67890&#39;
);</code></pre>

<p>Retrieve the subnet ID associated with a specific OpenQA job Returns the subnet ID</p>

<dl>

<dt id="region---AWS-region-where-the-subnet-is-located"><b>region</b> - AWS region where the subnet is located</dt>
<dd>

</dd>
<dt id="job_id---OpenQA-job-identifier-used-to-tag-the-subnet"><b>job_id</b> - OpenQA job identifier used to tag the subnet</dt>
<dd>

</dd>
</dl>

<h2 id="aws_subnet_delete">aws_subnet_delete</h2>

<pre><code>my $ret = aws_subnet_delete(
    region =&gt; &#39;us-west-1&#39;,
    job_id =&gt; &#39;67890&#39;
);</code></pre>

<p>Delete the subnet, do not assert but return the exit code of the command.</p>

<dl>

<dt id="region---AWS-region-where-the-subnet-is-located1"><b>region</b> - AWS region where the subnet is located</dt>
<dd>

</dd>
<dt id="job_id---OpenQA-job-identifier-used-to-tag-the-subnet1"><b>job_id</b> - OpenQA job identifier used to tag the subnet</dt>
<dd>

</dd>
</dl>

<h2 id="aws_internet_gateway_create">aws_internet_gateway_create</h2>

<pre><code>my $igw_id = aws_internet_gateway_create
    region =&gt; &#39;us-west-1&#39;,
    job_id =&gt; &#39;67890&#39;
);</code></pre>

<p>Create an internet gateway and tag it with the OpenQA job ID Returns the internet gateway ID</p>

<dl>

<dt id="region---AWS-region-where-to-create-the-internet-gateway"><b>region</b> - AWS region where to create the internet gateway</dt>
<dd>

</dd>
<dt id="job_id---OpenQA-job-identifier-used-to-tag-the-security-group2"><b>job_id</b> - OpenQA job identifier used to tag the security group</dt>
<dd>

</dd>
</dl>

<h2 id="aws_internet_gateway_get_id">aws_internet_gateway_get_id</h2>

<pre><code>my $igw_id = aws_internet_gateway_get_id(
    region =&gt; &#39;us-west-1&#39;,
    job_id =&gt; &#39;67890&#39;
);</code></pre>

<p>Retrieve the internet gateway ID associated with a specific OpenQA job Returns the internet gateway ID</p>

<dl>

<dt id="region---AWS-region-where-the-internet-gateway-is-located"><b>region</b> - AWS region where the internet gateway is located</dt>
<dd>

</dd>
<dt id="job_id---OpenQA-job-identifier-used-to-tag-the-internet-gateway"><b>job_id</b> - OpenQA job identifier used to tag the internet gateway</dt>
<dd>

</dd>
</dl>

<h2 id="aws_internet_gateway_attach">aws_internet_gateway_attach</h2>

<pre><code>aws_internet_gateway_attach(
    vpc_id =&gt; &#39;vpc-12345&#39;,
    igw_id =&gt; &#39;igw-abcde&#39;,
    region =&gt; &#39;us-west-1&#39;
);</code></pre>

<p>Attach an internet gateway to a VPC</p>

<dl>

<dt id="vpc_id---ID-of-the-VPC-to-attach-the-gateway-to"><b>vpc_id</b> - ID of the VPC to attach the gateway to</dt>
<dd>

</dd>
<dt id="igw_id---ID-of-the-internet-gateway-to-attach"><b>igw_id</b> - ID of the internet gateway to attach</dt>
<dd>

</dd>
<dt id="region---AWS-region-where-the-resources-are-located"><b>region</b> - AWS region where the resources are located</dt>
<dd>

</dd>
</dl>

<h2 id="aws_internet_gateway_delete">aws_internet_gateway_delete</h2>

<pre><code>my $ret = aws_internet_gateway_delete(
    job_id =&gt; &#39;6789&#39;,
    vpc_id =&gt; &#39;vpc-12345&#39;,
    region =&gt; &#39;us-west-1&#39;
);</code></pre>

<p>Delete the internet gateway, do not assert but return the exit code of the command.</p>

<dl>

<dt id="region---AWS-region-where-the-resources-are-located1"><b>region</b> - AWS region where the resources are located</dt>
<dd>

</dd>
<dt id="vpc_id---ID-of-the-VPC-to-attach-the-gateway-to1"><b>vpc_id</b> - ID of the VPC to attach the gateway to</dt>
<dd>

</dd>
<dt id="job_id---OpenQA-job-identifier-for-tagging1"><b>job_id</b> - OpenQA job identifier for tagging</dt>
<dd>

</dd>
</dl>

<h2 id="aws_route_table_create">aws_route_table_create</h2>

<pre><code>my $route_table_id = aws_route_table_create(
    region =&gt; &#39;us-west-1&#39;,
    vpc_id =&gt; &#39;vpc-12345&#39;
);</code></pre>

<p>Create a route table within a VPC Returns the route table ID</p>

<dl>

<dt id="region---AWS-region-where-to-create-the-route-table"><b>region</b> - AWS region where to create the route table</dt>
<dd>

</dd>
<dt id="vpc_id---ID-of-the-VPC-where-the-route-table-will-be-created"><b>vpc_id</b> - ID of the VPC where the route table will be created</dt>
<dd>

</dd>
</dl>

<h2 id="aws_route_table_associate">aws_route_table_associate</h2>

<pre><code>aws_route_table_associate(
    subnet_id =&gt; &#39;subnet-12345&#39;,
    route_table_id =&gt; &#39;rtb-abcde&#39;,
    region =&gt; &#39;us-west-1&#39;
);</code></pre>

<p>Associate a route table with a subnet</p>

<dl>

<dt id="subnet_id---ID-of-the-subnet-to-associate"><b>subnet_id</b> - ID of the subnet to associate</dt>
<dd>

</dd>
<dt id="route_table_id---ID-of-the-route-table-to-associate"><b>route_table_id</b> - ID of the route table to associate</dt>
<dd>

</dd>
<dt id="region---AWS-region-where-the-resources-are-located2"><b>region</b> - AWS region where the resources are located</dt>
<dd>

</dd>
</dl>

<h2 id="aws_route_table_delete">aws_route_table_delete</h2>

<pre><code>my $ret = aws_route_table_delete(
    vpc_id =&gt; &#39;subnet-12345&#39;,
    region =&gt; &#39;us-west-1&#39;
);</code></pre>

<p>Delete the route table(s), do not assert but return the first non-zero exit code of the commands, or 0 on success.</p>

<dl>

<dt id="vpc_id---ID-of-the-VPC"><b>vpc_id</b> - ID of the VPC</dt>
<dd>

</dd>
<dt id="region---AWS-region-where-the-resources-are-located3"><b>region</b> - AWS region where the resources are located</dt>
<dd>

</dd>
</dl>

<h2 id="aws_route_create">aws_route_create</h2>

<pre><code>aws_route_create(
    route_table_id =&gt; &#39;rtb-12345&#39;,
    destination_cidr_block =&gt; &#39;0.0.0.0/0&#39;,
    igw_id =&gt; &#39;igw-abcde&#39;,
    region =&gt; &#39;us-west-1&#39;
);</code></pre>

<p>Create a route in a route table pointing to an internet gateway</p>

<dl>

<dt id="route_table_id---ID-of-the-route-table-where-to-create-the-route"><b>route_table_id</b> - ID of the route table where to create the route</dt>
<dd>

</dd>
<dt id="destination_cidr_block---destination-CIDR-block-for-the-route-e.g.-0.0.0.0-0-for-default-route"><b>destination_cidr_block</b> - destination CIDR block for the route (e.g., &#39;0.0.0.0/0&#39; for default route)</dt>
<dd>

</dd>
<dt id="igw_id---ID-of-the-internet-gateway-as-the-route-target"><b>igw_id</b> - ID of the internet gateway as the route target</dt>
<dd>

</dd>
<dt id="region---AWS-region-where-the-resources-are-located4"><b>region</b> - AWS region where the resources are located</dt>
<dd>

</dd>
</dl>

<h2 id="aws_vm_create">aws_vm_create</h2>

<pre><code>my $instance_id = aws_vm_create(
    instance_type =&gt; &#39;t2.micro&#39;,
    image_name    =&gt; &#39;sles-15-sp3&#39;,
    subnet_id     =&gt; &#39;subnet-12345&#39;,
    sg_id         =&gt; &#39;sg-abcde&#39;,
    ssh_key       =&gt; &#39;my-key&#39;,
    region        =&gt; &#39;us-west-1&#39;,
    job_id        =&gt; &#39;67890&#39;
);</code></pre>

<p>Launch an EC2 instance with specified configuration and tag it with the OpenQA job ID Returns the instance ID</p>

<dl>

<dt id="instance_type---EC2-instance-type-e.g.-t2.micro-m5.large"><b>instance_type</b> - EC2 instance type (e.g., &#39;t2.micro&#39;, &#39;m5.large&#39;)</dt>
<dd>

</dd>
<dt id="image_name---Name-to-use-for-the-instance"><b>image_name</b> - Name to use for the instance</dt>
<dd>

</dd>
<dt id="owner---Image-owner-used-to-serch-the-AMI"><b>owner</b> - Image owner, used to serch the AMI</dt>
<dd>

</dd>
<dt id="subnet_id---ID-of-the-subnet-where-to-launch-the-instance"><b>subnet_id</b> - ID of the subnet where to launch the instance</dt>
<dd>

</dd>
<dt id="sg_id---ID-of-the-security-group-to-assign-to-the-instance"><b>sg_id</b> - ID of the security group to assign to the instance</dt>
<dd>

</dd>
<dt id="ssh_key---name-of-the-SSH-key-pair-for-instance-access"><b>ssh_key</b> - name of the SSH key pair for instance access</dt>
<dd>

</dd>
<dt id="region---AWS-region-where-to-launch-the-instance"><b>region</b> - AWS region where to launch the instance</dt>
<dd>

</dd>
<dt id="job_id---OpenQA-job-identifier-used-to-tag-the-internet-gateway1"><b>job_id</b> - OpenQA job identifier used to tag the internet gateway</dt>
<dd>

</dd>
</dl>

<h2 id="aws_vm_get_id">aws_vm_get_id</h2>

<pre><code>my $instance_id = aws_vm_get_id(
    region =&gt; &#39;us-west-1&#39;,
    job_id =&gt; &#39;67890&#39;
);</code></pre>

<p>Retrieve the EC2 instance ID associated with a specific OpenQA job Returns the instance ID</p>

<dl>

<dt id="region---AWS-region-where-the-instance-is-located"><b>region</b> - AWS region where the instance is located</dt>
<dd>

</dd>
<dt id="job_id---OpenQA-job-identifier-used-to-tag-the-instance"><b>job_id</b> - OpenQA job identifier used to tag the instance</dt>
<dd>

</dd>
</dl>

<h2 id="aws_vm_wait_status_ok">aws_vm_wait_status_ok</h2>

<pre><code>aws_vm_wait_status_ok(
    instance_id =&gt; &#39;i-12345&#39;
);</code></pre>

<p>Wait for an EC2 instance to reach &#39;running&#39; state with a timeout of 600 seconds</p>

<dl>

<dt id="instance_id---ID-of-the-instance-to-monitor"><b>instance_id</b> - ID of the instance to monitor</dt>
<dd>

</dd>
</dl>

<h2 id="aws_get_ip_address">aws_get_ip_address</h2>

<pre><code>my $ip = aws_get_ip_address(
    instance_id =&gt; &#39;i-12345&#39;
);</code></pre>

<p>Retrieve the public IP address of an EC2 instance Returns the public IP address</p>

<dl>

<dt id="instance_id---ID-of-the-instance"><b>instance_id</b> - ID of the instance</dt>
<dd>

</dd>
</dl>

<h2 id="aws_vm_terminate">aws_vm_terminate</h2>

<pre><code>my $ret = aws_vm_terminate(
    region =&gt; &#39;us-west-1&#39;,
    instance_id =&gt; &#39;i-12345&#39;
);</code></pre>

<p>Terminate an EC2 instance and wait for it to be terminated, do not assert but return the exit code of the command.</p>

<dl>

<dt id="region---AWS-region-where-the-instance-is-located1"><b>region</b> - AWS region where the instance is located</dt>
<dd>

</dd>
<dt id="instance_id---ID-of-the-instance-to-terminate"><b>instance_id</b> - ID of the instance to terminate</dt>
<dd>

</dd>
</dl>

<h2 id="aws_ssh_key_pair_import">aws_ssh_key_pair_import</h2>

<pre><code>aws_ssh_key_pair_import(
    ssh_key      =&gt; &#39;my-key&#39;,
    pub_key_path =&gt; &#39;/path/to/key.pub&#39;
);</code></pre>

<p>Import an SSH public key pair into AWS EC2 for instance authentication</p>

<dl>

<dt id="ssh_key---name-to-assign-to-the-imported-key-pair-in-AWS"><b>ssh_key</b> - name to assign to the imported key pair in AWS</dt>
<dd>

</dd>
<dt id="pub_key_path---filesystem-path-to-the-public-key-file"><b>pub_key_path</b> - filesystem path to the public key file</dt>
<dd>

</dd>
</dl>


</body>

</html>


