<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>lib/sles4sap/qesap/qesap_aws.pm</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel='stylesheet' href='../../style.css' />
</head>

<body>



<ul id="index"><li><a href="../../index.html"><i>&lt;= Back to file list</i></a></li>
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#COPYRIGHT">COPYRIGHT</a></li>
  <li><a href="#AUTHORS">AUTHORS</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a>
    <ul>
      <li><a href="#Methods">Methods</a>
        <ul>
          <li><a href="#qesap_aws_get_region_subnets">qesap_aws_get_region_subnets</a></li>
          <li><a href="#qesap_aws_create_credentials">qesap_aws_create_credentials</a></li>
          <li><a href="#qesap_aws_create_config">qesap_aws_create_config</a></li>
          <li><a href="#qesap_aws_get_vpc_id">qesap_aws_get_vpc_id</a></li>
          <li><a href="#qesap_aws_get_transit_gateway_vpc_attachment-Ged-a-description-of-one-or-more-transit-gateway-attachments-Function-support-optional-arguments-that-are-translated-to-filters:---transit_gateway_attach_id---name">qesap_aws_get_transit_gateway_vpc_attachment Ged a description of one or more transit-gateway-attachments Function support optional arguments that are translated to filters: - transit_gateway_attach_id - name</a></li>
          <li><a href="#qesap_aws_create_transit_gateway_vpc_attachment">qesap_aws_create_transit_gateway_vpc_attachment</a></li>
          <li><a href="#qesap_aws_delete_transit_gateway_vpc_attachment">qesap_aws_delete_transit_gateway_vpc_attachment</a></li>
          <li><a href="#qesap_aws_add_route_to_tgw-Adding-the-route-to-the-transit-gateway-to-the-routing-table-in-refhost-VPC">qesap_aws_add_route_to_tgw Adding the route to the transit gateway to the routing table in refhost VPC</a></li>
          <li><a href="#qesap_aws_filter_query">qesap_aws_filter_query</a></li>
          <li><a href="#qesap_aws_get_mirror_tg">qesap_aws_get_mirror_tg</a></li>
          <li><a href="#qesap_aws_get_vpc_workspace">qesap_aws_get_vpc_workspace</a></li>
          <li><a href="#qesap_aws_get_routing">qesap_aws_get_routing</a></li>
          <li><a href="#qesap_aws_vnet_peering">qesap_aws_vnet_peering</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul><h1>lib/sles4sap/qesap/qesap_aws.pm</h1>

<h1 id="NAME">NAME</h1>

<pre><code>AWS related functions for the qe-sap-deployment test lib</code></pre>

<h1 id="COPYRIGHT">COPYRIGHT</h1>

<pre><code>Copyright 2025 SUSE LLC
SPDX-License-Identifier: FSFAP</code></pre>

<h1 id="AUTHORS">AUTHORS</h1>

<pre><code>QE SAP &lt;qe-sap@suse.de&gt;</code></pre>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<pre><code>Package with AWS related methods for qe-sap-deployment</code></pre>

<h2 id="Methods">Methods</h2>

<h3 id="qesap_aws_get_region_subnets">qesap_aws_get_region_subnets</h3>

<p>Return a list of subnets. Return a single subnet for each region.</p>

<dl>

<dt id="VPC_ID---VPC-ID-of-resource-to-filter-list-of-subnets"><b>VPC_ID</b> - VPC ID of resource to filter list of subnets</dt>
<dd>

</dd>
</dl>

<h3 id="qesap_aws_create_credentials">qesap_aws_create_credentials</h3>

<pre><code>Creates a AWS credentials file as required by QE-SAP Terraform deployment code.</code></pre>

<dl>

<dt id="KEY---value-for-the-aws_access_key_id"><b>KEY</b> - value for the aws_access_key_id</dt>
<dd>

</dd>
<dt id="SECRET---value-for-the-aws_secret_access_key"><b>SECRET</b> - value for the aws_secret_access_key</dt>
<dd>

</dd>
<dt id="CONF_TRGT---qesap_conf_trgt-value-in-the-output-of-qesap_get_file_paths"><b>CONF_TRGT</b> - qesap_conf_trgt value in the output of qesap_get_file_paths</dt>
<dd>

</dd>
</dl>

<h3 id="qesap_aws_create_config">qesap_aws_create_config</h3>

<pre><code>Creates a AWS configuration file in ~/.aws/config
as required by the QE-SAP Terraform &amp; Ansible deployment code.
Content is mostly (only) about region.</code></pre>

<dl>

<dt id="REGION---cloud-region-as-usually-provided-by-PUBLIC_CLOUD_REGION"><b>REGION</b> - cloud region as usually provided by PUBLIC_CLOUD_REGION</dt>
<dd>

</dd>
</dl>

<h3 id="qesap_aws_get_vpc_id">qesap_aws_get_vpc_id</h3>

<pre><code>Get the vpc_id of a given instance in the cluster.
This function looks for the cluster using the aws describe-instances
and filtering by terraform deployment_name value, that qe-sap-deployment
is kind to use as tag for each resource.</code></pre>

<dl>

<dt id="RESOURCE_GROUP---value-of-the-workspace-tag-configured-in-qe-sap-deployment-usually-it-is-the-deployment-name"><b>RESOURCE_GROUP</b> - value of the workspace tag configured in qe-sap-deployment, usually it is the deployment name</dt>
<dd>

</dd>
</dl>

<h3 id="qesap_aws_get_transit_gateway_vpc_attachment-Ged-a-description-of-one-or-more-transit-gateway-attachments-Function-support-optional-arguments-that-are-translated-to-filters:---transit_gateway_attach_id---name">qesap_aws_get_transit_gateway_vpc_attachment Ged a description of one or more transit-gateway-attachments Function support optional arguments that are translated to filters: - transit_gateway_attach_id - name</h3>

<pre><code>Example:
  qesap_aws_get_transit_gateway_vpc_attachment(name =&gt; &#39;SOMETHING&#39;)

  Result internally in aws cli to be called like

  aws ec2 describe-transit-gateway-attachments --filter=&#39;Name=tag:Name,Values=SOMETHING

Only one filter mode is supported at any time.

Returns a HASH reference to the decoded JSON returned by the AWS command or undef on failure.</code></pre>

<h3 id="qesap_aws_create_transit_gateway_vpc_attachment">qesap_aws_create_transit_gateway_vpc_attachment</h3>

<pre><code>Call create-transit-gateway-vpc-attachment and
wait until Transit Gateway Attachment is available.

Return 1 (true) if properly managed to create the transit-gateway-vpc-attachment
Return 0 (false) if create-transit-gateway-vpc-attachment fails or
              the gateway does not become active before the timeout</code></pre>

<dl>

<dt id="TRANSIT_GATEWAY_ID---ID-of-the-target-Transit-gateway-IBS-Mirror"><b>TRANSIT_GATEWAY_ID</b> - ID of the target Transit gateway (IBS Mirror)</dt>
<dd>

</dd>
<dt id="VPC_ID---VPC-ID-of-resource-to-be-attached-SUT-HANA-cluster"><b>VPC_ID</b> - VPC ID of resource to be attached (SUT HANA cluster)</dt>
<dd>

</dd>
<dt id="SUBNET_ID_LIST---List-of-subnet-to-connect-SUT-HANA-cluster"><b>SUBNET_ID_LIST</b> - List of subnet to connect (SUT HANA cluster)</dt>
<dd>

</dd>
<dt id="NAME---Prefix-for-the-Tag-Name-of-transit-gateway-vpc-attachment"><b>NAME</b> - Prefix for the Tag Name of transit-gateway-vpc-attachment</dt>
<dd>

</dd>
<dt id="TIMEOUT---default-is-5-mins"><b>TIMEOUT</b> - default is 5 mins</dt>
<dd>

</dd>
</dl>

<h3 id="qesap_aws_delete_transit_gateway_vpc_attachment">qesap_aws_delete_transit_gateway_vpc_attachment</h3>

<pre><code>Call delete-transit-gateway-vpc-attachment and
wait until Transit Gateway Attachment is deleted.

Return 1 (true) if properly managed to delete the tgw-attachment OR &#39;wait&#39; is 0
Return 0 (false) if wait=1 AND delete-transit-gateway-vpc-attachment fails or timeout is reached</code></pre>

<dl>

<dt id="ID---id-of-the-TGW-attachment-to-be-deleted"><b>ID</b> - id of the TGW attachment to be deleted</dt>
<dd>

</dd>
<dt id="TIMEOUT---default-is-5-mins1"><b>TIMEOUT</b> - default is 5 mins</dt>
<dd>

</dd>
<dt id="WAIT---whether-to-wait-to-verify-deleted-status-or-not"><b>WAIT</b> - whether to wait to verify deleted status or not</dt>
<dd>

</dd>
</dl>

<h3 id="qesap_aws_add_route_to_tgw-Adding-the-route-to-the-transit-gateway-to-the-routing-table-in-refhost-VPC">qesap_aws_add_route_to_tgw Adding the route to the transit gateway to the routing table in refhost VPC</h3>

<dl>

<dt id="RTABLE_ID---Routing-table-ID"><b>RTABLE_ID</b> - Routing table ID</dt>
<dd>

</dd>
<dt id="TARGET_IP_NET---Target-IP-network-to-be-added-to-the-Routing-table-eg.-192.168.11.0-16"><b>TARGET_IP_NET</b> - Target IP network to be added to the Routing table eg. 192.168.11.0/16</dt>
<dd>

</dd>
<dt id="TRANSIT_GATEWAY_ID---ID-of-the-target-Transit-gateway-IBS-Mirror1"><b>TRANSIT_GATEWAY_ID</b> - ID of the target Transit gateway (IBS Mirror)</dt>
<dd>

</dd>
</dl>

<h3 id="qesap_aws_filter_query">qesap_aws_filter_query</h3>

<pre><code>Generic function to compose a aws cli command with:
  - `aws ec2` something
  - use both `filter` and `query`
  - has text output</code></pre>

<h3 id="qesap_aws_get_mirror_tg">qesap_aws_get_mirror_tg</h3>

<pre><code>Return the Transient Gateway ID of the IBS Mirror</code></pre>

<dl>

<dt id="MIRROR_TAG---Value-of-Project-tag-applied-to-the-IBS-Mirror"><b>MIRROR_TAG</b> - Value of Project tag applied to the IBS Mirror</dt>
<dd>

</dd>
</dl>

<h3 id="qesap_aws_get_vpc_workspace">qesap_aws_get_vpc_workspace</h3>

<pre><code>Get the VPC tag workspace defined in
https://github.com/SUSE/qe-sap-deployment/blob/main/terraform/aws/infrastructure.tf</code></pre>

<dl>

<dt id="VPC_ID---VPC-ID-of-resource-to-be-attached-SUT-HANA-cluster1"><b>VPC_ID</b> - VPC ID of resource to be attached (SUT HANA cluster)</dt>
<dd>

</dd>
</dl>

<h3 id="qesap_aws_get_routing">qesap_aws_get_routing</h3>

<pre><code>Get the Routing table: searching Routing Table with external connection
and get the RouteTableId</code></pre>

<dl>

<dt id="VPC_ID---VPC-ID-of-resource-to-be-attached-SUT-HANA-cluster2"><b>VPC_ID</b> - VPC ID of resource to be attached (SUT HANA cluster)</dt>
<dd>

</dd>
</dl>

<h3 id="qesap_aws_vnet_peering">qesap_aws_vnet_peering</h3>

<pre><code>Create a pair of network peering between
the two provided deployments.

Return 1 (true) if the overall peering procedure completes successfully</code></pre>

<dl>

<dt id="TARGET_IP---Target-IP-network-to-be-added-to-the-Routing-table-eg.-192.168.11.0-16"><b>TARGET_IP</b> - Target IP network to be added to the Routing table eg. 192.168.11.0/16</dt>
<dd>

</dd>
<dt id="VPC_ID---VPC-ID-of-resource-to-be-attached-SUT-HANA-cluster3"><b>VPC_ID</b> - VPC ID of resource to be attached (SUT HANA cluster)</dt>
<dd>

</dd>
<dt id="MIRROR_TAG---Value-of-Project-tag-applied-to-the-IBS-Mirror1"><b>MIRROR_TAG</b> - Value of Project tag applied to the IBS Mirror</dt>
<dd>

</dd>
</dl>


</body>

</html>


