<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Trento test lib</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel='stylesheet' href='./style.css' />
</head>

<body>



<ul id="index"><li><a href="./index.html"><i>&lt;= Back to file list</i></a></li>
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#COPYRIGHT">COPYRIGHT</a></li>
  <li><a href="#AUTHORS">AUTHORS</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a>
    <ul>
      <li><a href="#Methods">Methods</a>
        <ul>
          <li><a href="#get_trento_deployment">get_trento_deployment</a></li>
          <li><a href="#get_resource_group">get_resource_group</a></li>
          <li><a href="#cluster_config">cluster_config</a></li>
          <li><a href="#deploy_vm">deploy_vm</a></li>
          <li><a href="#trento_acr_azure">trento_acr_azure</a></li>
          <li><a href="#install_trento">install_trento</a></li>
          <li><a href="#cluster_deploy">cluster_deploy</a></li>
          <li><a href="#cluster_destroy">cluster_destroy</a></li>
          <li><a href="#get_vm_name">get_vm_name</a></li>
          <li><a href="#get_acr_name">get_acr_name</a></li>
          <li><a href="#get_trento_ip">get_trento_ip</a></li>
          <li><a href="#get_trento_private_ip">get_trento_private_ip</a></li>
          <li><a href="#get_trento_password">get_trento_password</a></li>
          <li><a href="#az_delete_group">az_delete_group</a></li>
          <li><a href="#az_vm_ssh_cmd">az_vm_ssh_cmd</a></li>
          <li><a href="#cluster_install_agent">cluster_install_agent</a></li>
          <li><a href="#k8s_logs">k8s_logs</a></li>
          <li><a href="#k8s_test">k8s_test</a></li>
          <li><a href="#trento_support">trento_support</a></li>
          <li><a href="#trento_collect_scenarios">trento_collect_scenarios</a></li>
          <li><a href="#trento_api_key">trento_api_key</a></li>
          <li><a href="#cluster_print_cluster_status">cluster_print_cluster_status</a></li>
          <li><a href="#cluster_hdbadm">cluster_hdbadm</a></li>
          <li><a href="#cluster_wait_status">cluster_wait_status</a></li>
          <li><a href="#cluster_wait_status_by_regex">cluster_wait_status_by_regex</a></li>
          <li><a href="#cluster_trento_net_peering">cluster_trento_net_peering</a></li>
          <li><a href="#podman_self_check">podman_self_check</a></li>
          <li><a href="#cypress_configs">cypress_configs</a></li>
          <li><a href="#cypress_install_container">cypress_install_container</a></li>
          <li><a href="#cypress_log_upload">cypress_log_upload</a></li>
          <li><a href="#cypress_exec">cypress_exec</a></li>
          <li><a href="#cypress_test_exec">cypress_test_exec</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#POD-ERRORS">POD ERRORS</a></li>
</ul><h1>lib/trento.pm</h1>

<h1 id="NAME">NAME</h1>

<p>Trento test lib</p>

<h1 id="COPYRIGHT">COPYRIGHT</h1>

<p>Copyright 2022 SUSE LLC SPDX-License-Identifier: FSFAP</p>

<h1 id="AUTHORS">AUTHORS</h1>

<p>QE SAP &lt;qe-sap@suse.de&gt;</p>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<p>Package with common methods and default or constant values for Trento tests</p>

<h2 id="Methods">Methods</h2>

<p>Clone gitlab.suse.de/qa-css/trento</p>

<dl>

<dt id="WORK_DIR---folder-where-to-clone-the-repo"><b>WORK_DIR</b> - folder where to clone the repo</dt>
<dd>

</dd>
</dl>

<h3 id="get_trento_deployment">get_trento_deployment</h3>

<p>Get the set of scripts for the Trento deployment</p>

<dl>

<dt id="WORK_DIR---folder-where-to-clone-the-repo1"><b>WORK_DIR</b> - folder where to clone the repo</dt>
<dd>

</dd>
</dl>

<h3 id="get_resource_group">get_resource_group</h3>

<p>Return a string to be used as cloud resource group. It contains the JobId</p>

<h3 id="cluster_config">cluster_config</h3>

<p>Create a variable map and prepare the qe-sap-deployment using it =over 3</p>

<dl>

<dt id="PROVIDER---CloudProvider-name"><b>PROVIDER</b> - CloudProvider name</dt>
<dd>

</dd>
<dt id="REGION---region-for-the-deployment"><b>REGION</b> - region for the deployment</dt>
<dd>

</dd>
<dt id="SCC---SCC_REGCODE"><b>SCC</b> - SCC_REGCODE</dt>
<dd>

</dd>
</dl>

<h3 id="deploy_vm">deploy_vm</h3>

<p>Deploy the main VM for the Trento application Based on 00.040-trento_vm_server_deploy_azure.sh</p>

<dl>

<dt id="WORK_DIR---folder-where-to-clone-the-repo2"><b>WORK_DIR</b> - folder where to clone the repo</dt>
<dd>

</dd>
</dl>

<h3 id="trento_acr_azure">trento_acr_azure</h3>

<p>Create ACR in Azure and upload from IBS needed images Based on trento_acr_azure.sh</p>

<dl>

<dt id="WORK_DIR---folder-where-to-clone-the-repo3"><b>WORK_DIR</b> - folder where to clone the repo</dt>
<dd>

</dd>
</dl>

<h3 id="install_trento">install_trento</h3>

<p>Install Trento on the VM. Based on 01.010-trento_server_installation_premium_v.sh</p>

<h3 id="cluster_deploy">cluster_deploy</h3>

<p>Deploy a SAP Landscape using a previously configured qe-sap-deployment</p>

<h3 id="cluster_destroy">cluster_destroy</h3>

<p>Destroy the qe-sap-deployment SAP Landscape</p>

<h3 id="get_vm_name">get_vm_name</h3>

<p>Return a string to be used as cloud VM name. It contains the JobId</p>

<h3 id="get_acr_name">get_acr_name</h3>

<p>Return a string to be used as cloud ACR name. It contains the JobId</p>

<h3 id="get_trento_ip">get_trento_ip</h3>

<p>Return the running VM public IP</p>

<h3 id="get_trento_private_ip">get_trento_private_ip</h3>

<p>Return the private IP of the Trento instance, needed by the agent configuration</p>

<h3 id="get_trento_password">get_trento_password</h3>

<p>Return the password for the Trento WebUI</p>

<h3 id="az_delete_group">az_delete_group</h3>

<p>Delete the resource group associated to this JobID and all its content</p>

<h3 id="az_vm_ssh_cmd">az_vm_ssh_cmd</h3>

<p>Compose <i>ssh</i> command for remote execution on the VM machine. The function optionally accept the VM public IP. If not provided, the IP is calculated on the fly with an <i>az</i> query, take care that is a time consuming <i>az</i> query.</p>

<dl>

<dt id="CMD_ARG---String-of-the-command-to-be-executed-remotely"><b>CMD_ARG</b> - String of the command to be executed remotely</dt>
<dd>

</dd>
<dt id="VM_IP_ARG---Public-IP-of-the-remote-machine-where-to-execute-the-command"><b>VM_IP_ARG</b> - Public IP of the remote machine where to execute the command</dt>
<dd>

</dd>
</dl>

<h3 id="cluster_install_agent">cluster_install_agent</h3>

<p>Install trento-agent on all the nodes. Installation is performed using ansible.</p>

<dl>

<dt id="WORK_DIRECTORY---Working-directory-used-to-eventually-download-.rpm"><b>WORK_DIRECTORY</b> - Working directory, used to eventually download .rpm</dt>
<dd>

</dd>
<dt id="PLAYBOOK_LOCATION---Path-where-to-find-trento-agent.yaml-file"><b>PLAYBOOK_LOCATION</b> - Path where to find trento-agent.yaml file</dt>
<dd>

</dd>
<dt id="API_KEY---Api-key-needed-to-configure-trento-agent"><b>API_KEY</b> - Api key needed to configure trento-agent</dt>
<dd>

</dd>
</dl>

<h3 id="k8s_logs">k8s_logs</h3>

<p>Get all relevant info out from the cluster</p>

<dl>

<dt id="CMD_ARG---String-of-the-command-to-be-executed-remotely1"><b>CMD_ARG</b> - String of the command to be executed remotely</dt>
<dd>

</dd>
<dt id="VM_IP_ARG---Public-IP-of-the-remote-machine-where-to-execute-the-command1"><b>VM_IP_ARG</b> - Public IP of the remote machine where to execute the command</dt>
<dd>

</dd>
</dl>

<h3 id="k8s_test">k8s_test</h3>

<p>Test Trento VM and k8s cluster running on it</p>

<h3 id="trento_support">trento_support</h3>

<p>Call trento-support.sh and dump_scenario_from_k8.sh and upload the logs</p>

<h3 id="trento_collect_scenarios">trento_collect_scenarios</h3>

<p>Call dump_scenario_from_k8.sh and upload the logs</p>

<h3 id="trento_api_key">trento_api_key</h3>

<p>Get the api-key from the Trento installation</p>

<dl>

<dt id="BASEDIR---Folder-of-the-trento-installer-repo-clone"><b>BASEDIR</b> - Folder of the trento installer repo clone</dt>
<dd>

</dd>
</dl>

<h3 id="cluster_print_cluster_status">cluster_print_cluster_status</h3>

<p>Run `crm status` and `SAPHanaSR-showAttr --format=script` on the specified host. Command is executed remotely with Ansible and nothing more (no output collected for further processing)</p>

<h3 id="cluster_hdbadm">cluster_hdbadm</h3>

<p>Remotly run on $host as user hdbadm</p>

<h3 id="cluster_wait_status">cluster_wait_status</h3>

<p>This function allow to wait for a specific output for &#39;SAPHanaSR-showAttr&#39;, on one specific remote host. Remotly runs &#39;SAPHanaSR-showAttr&#39; on $host. Runs &#39;SAPHanaSR-showAttr&#39; multiple times in a loop, retying until the output PASS the test &#39;f_status&#39;. The &#39;f_status&#39; test is passed as a &quot;function pointer&quot;.</p>

<p>Usage example: cluster_wait_status($primary_host, sub { ((shift =~ m/.+UNDEFINED.+SFAIL/) &amp;&amp; (shift =~ m/.+PROMOTED.+PRIM/)); });</p>

<p>This one result in SAPHanaSR-showAttr to be called on the HANA PRIMARY until : the line about vmhana01 match with regexp .+UNDEFINED.+SFAIL AND the line about vmhana02 match with regexp .+PROMOTED.+PRIM</p>

<dl>

<dt id="HOST---Ansible-name-or-filter-for-the-remote-host-where-to-run-SAPHanaSR-showAttr"><b>HOST</b> - Ansible name or filter for the remote host where to run &#39;SAPHanaSR-showAttr&#39;</dt>
<dd>

</dd>
<dt id="F_STATUS---Function-pointer-to-test-the-SAPHanaSR-showAttr-stdout.-Provided-function-has-to-support-two-arguments.-cluster_wait_status-will-call-the-f_status-passing-as-first-arguments-only-the-output-lines-of-SAPHanaSR-showAttr-about-the-vmhana01-and-as-second-arguments-lines-about-vmhana02"><b>F_STATUS</b> - Function pointer to test the &#39;SAPHanaSR-showAttr&#39; stdout. Provided function has to support two arguments. `cluster_wait_status` will call the `f_status` passing as first arguments only the output lines of &#39;SAPHanaSR-showAttr&#39; about the vmhana01, and as second arguments lines about vmhana02</dt>
<dd>

</dd>
<dt id="TIMEOUT---Max-time-to-retry.-Die-if-timeout"><b>TIMEOUT</b> - Max time to retry. Die if timeout</dt>
<dd>

</dd>
</dl>

<h3 id="cluster_wait_status_by_regex">cluster_wait_status_by_regex</h3>

<p>Remotely run &#39;SAPHanaSR-showAttr&#39; in a loop on $host, wait output that matches regular expression =over 3</p>

<dl>

<dt id="HOST---Ansible-name-or-filter-for-the-remote-host-where-to-run-SAPHanaSR-showAttr1"><b>HOST</b> - Ansible name or filter for the remote host where to run &#39;SAPHanaSR-showAttr&#39;</dt>
<dd>

</dd>
<dt id="TIMEOUT---Max-time-to-retry.-Die-if-timeout1"><b>TIMEOUT</b> - Max time to retry. Die if timeout</dt>
<dd>

</dd>
<dt id="REGULAR_EXPRESSION---Regular-expression-to-match-the-text-to-find"><b>REGULAR_EXPRESSION</b> - Regular expression to match the text to find</dt>
<dd>

</dd>
</dl>

<h3 id="cluster_trento_net_peering">cluster_trento_net_peering</h3>

<p>Run 00.050 net peering script</p>

<h3 id="podman_self_check">podman_self_check</h3>

<p>Perform some generic checks related to the podman installation itself and the relevant parameters of the current machine environment.</p>

<h3 id="cypress_configs">cypress_configs</h3>

<p>Prepare all the configuration files for cypress</p>

<dl>

<dt id="CYPRESS_TEST_DIR---Cypress-test-code-location"><b>CYPRESS_TEST_DIR</b> - Cypress test code location.</dt>
<dd>

</dd>
</dl>

<h3 id="cypress_install_container">cypress_install_container</h3>

<p>Prepare whatever is needed to run cypress tests using container</p>

<h3 id="cypress_log_upload">cypress_log_upload</h3>

<p>Upload to openQA the relevant logs</p>

<dl>

<dt id="LOG_FILTER---List-of-strings.-List-of-file-extensions-dot-needed"><b>LOG_FILTER</b> - List of strings. List of file extensions (dot needed)</dt>
<dd>

</dd>
</dl>

<h3 id="cypress_exec">cypress_exec</h3>

<p>Execute a cypress command within the container</p>

<dl>

<dt id="CYPRESS_TEST_DIR---String-of-the-path-where-the-cypress-Trento-code-is-available.-It-is-the-test-folder-within-the-path-used-by-setup_jumphost"><b>CYPRESS_TEST_DIR</b> - String of the path where the cypress Trento code is available. It is the <i>test</i> folder within the path used by <a>setup_jumphost</a></dt>
<dd>

</dd>
<dt id="CMD---String-of-cmd-to-be-used-as-main-argument-for-the-cypress-executable-call"><b>CMD</b> - String of cmd to be used as main argument for the cypress executable call.</dt>
<dd>

</dd>
<dt id="LOG_PREFIX---String-of-the-command-to-be-executed-remotely"><b>LOG_PREFIX</b> - String of the command to be executed remotely</dt>
<dd>

</dd>
<dt id="TIMEOUT---Integer-used-as-timeout-for-the-cypress-command-execution"><b>TIMEOUT</b> - Integer used as timeout for the cypress command execution</dt>
<dd>

</dd>
</dl>

<h3 id="cypress_test_exec">cypress_test_exec</h3>

<p>Execute a set of cypress tests. Execute, one by one, all tests in all .js files in the provided folder.</p>

<dl>

<dt id="CYPRESS_TEST_DIR---String-of-the-path-where-the-cypress-Trento-code-is-available.-It-is-the-test-folder-within-the-path-used-by-setup_jumphost1"><b>CYPRESS_TEST_DIR</b> - String of the path where the cypress Trento code is available. It is the <i>test</i> folder within the path used by <a>setup_jumphost</a></dt>
<dd>

</dd>
<dt id="TEST_TAG---String-of-the-test-subfolder-within-cypress_test_dir-cypress-integration-Also-used-as-tag-for-each-test-result-file"><b>TEST_TAG</b> - String of the test subfolder within <i>$cypress_test_dir/cypress/integration</i> Also used as tag for each test result file</dt>
<dd>

</dd>
<dt id="TIMEOUT---Integer-used-as-timeout-for-the-internal-cypress_exec-call"><b>TIMEOUT</b> - Integer used as timeout for the internal <a>cypress_exec</a> call</dt>
<dd>

</dd>
</dl>

<h1 id="POD-ERRORS">POD ERRORS</h1>

<p>Hey! <b>The above document had some coding errors, which are explained below:</b></p>

<dl>

<dt id="Around-line-105">Around line 105:</dt>
<dd>

<p>Unknown directive: =hean3</p>

</dd>
<dt id="Around-line-239">Around line 239:</dt>
<dd>

<p>&#39;=item&#39; outside of any &#39;=over&#39;</p>

</dd>
<dt id="Around-line-863">Around line 863:</dt>
<dd>

<p>&#39;=item&#39; outside of any &#39;=over&#39;</p>

</dd>
</dl>


</body>

</html>


