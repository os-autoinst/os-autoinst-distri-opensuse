From 47298e2004dc74654c88a76d2d68eaa2c0e999b8 Mon Sep 17 00:00:00 2001
From: Ricardo Branco <rbranco@suse.de>
Date: Sat, 31 Jan 2026 13:28:14 +0100
Subject: [PATCH] integration: Support containerd pull error message

Docker v29+ uses containerd's error format for non-existent images.

Signed-off-by: Ricardo Branco <rbranco@suse.de>
---
 integration/image/pull_test.go | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/integration/image/pull_test.go b/integration/image/pull_test.go
index 562ca36b252a2..e509f28ff6319 100644
--- a/integration/image/pull_test.go
+++ b/integration/image/pull_test.go
@@ -188,8 +188,10 @@ func TestImagePullNonExisting(t *testing.T) {
 				rdr.Close()
 			}
 
-			expectedMsg := fmt.Sprintf("pull access denied for %s, repository does not exist or may require 'docker login'", "asdfasdf")
-			assert.Check(t, is.ErrorContains(err, expectedMsg))
+			legacyMsg := fmt.Sprintf("pull access denied for %s, repository does not exist or may require 'docker login'", "asdfasdf")
+			modernMsg := fmt.Sprintf("failed to resolve reference %q", "docker.io/library/asdfasdf:latest")
+			errMsg := err.Error()
+			assert.Check(t, strings.Contains(errMsg, legacyMsg) || strings.Contains(errMsg, modernMsg))
 			assert.Check(t, is.ErrorType(err, cerrdefs.IsNotFound))
 			if all {
 				// pull -a on a nonexistent registry should fall back as well
