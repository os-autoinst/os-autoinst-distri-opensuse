From 5f63e8548e0263ae298b3804ba702ea6b1bd1e99 Mon Sep 17 00:00:00 2001
From: Ricardo Branco <rbranco@suse.de>
Date: Fri, 27 Feb 2026 20:16:12 +0100
Subject: [PATCH] integration/container: use page-aligned shm size to fix test
 on ppc64le

On architectures with 64k page size (e.g. ppc64le), the kernel rounds
shm sizes up to the nearest page boundary. Using 1000k as the default
shm size resulted in the custom size test requesting 2000k, which was
rounded up to 2048k in /proc/self/mountinfo, causing the test to fail.

Switch the default to 1024k so that the doubled value (2048k) is
already aligned on both 4k and 64k page boundaries.

Signed-off-by: Ricardo Branco <rbranco@suse.de>
---
 integration/container/run_linux_test.go | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/integration/container/run_linux_test.go b/integration/container/run_linux_test.go
index 99f81657bcce5..ac5e46461566b 100644
--- a/integration/container/run_linux_test.go
+++ b/integration/container/run_linux_test.go
@@ -502,7 +502,7 @@ func TestCgroupRW(t *testing.T) {
 func TestContainerShmSize(t *testing.T) {
 	ctx := setupTest(t)
 
-	const defaultSize = "1000k"
+	const defaultSize = "1024k"
 	defaultSizeBytes, err := units.RAMInBytes(defaultSize)
 	assert.NilError(t, err)
 
@@ -531,7 +531,7 @@ func TestContainerShmSize(t *testing.T) {
 		{
 			doc:     "custom shmSize",
 			opt:     container.WithHostConfig(&containertypes.HostConfig{ShmSize: defaultSizeBytes * 2}),
-			expSize: "2000k",
+			expSize: "2048k",
 		},
 		{
 			doc:    "negative shmSize",
@@ -568,7 +568,7 @@ func TestContainerShmSize(t *testing.T) {
 			out, err := container.Output(ctx, apiClient, cID)
 			assert.NilError(t, err)
 
-			// e.g., "218 213 0:87 / /dev/shm rw,nosuid,nodev,noexec,relatime - tmpfs shm rw,size=1000k"
+			// e.g., "218 213 0:87 / /dev/shm rw,nosuid,nodev,noexec,relatime - tmpfs shm rw,size=1024k"
 			assert.Assert(t, is.Contains(out.Stdout, "/dev/shm "), "shm mount not found in output: \n%v", out.Stdout)
 			assert.Check(t, is.Contains(out.Stdout, "size="+tc.expSize))
 		})
