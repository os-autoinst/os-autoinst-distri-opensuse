---
name: client_node
description: >
  Schedule for client node tests.
  Sometimes a client machine is needed to query/check the cluster.
  Ctdb, hawk, or pacemaker-cts are using a client.

  Some settings are required in the job group or test suite for this schedule to work.

  The other settings required in the job group are.

  CLUSTER_NAME must be defined for all jobs as a string.
  CTDB_TEST_ROLE, PACEMAKER_TEST_ROLE or HAWKGUI_TEST_ROLE (depends of the test) must be defined to client.
  DESKTOP must be defined as textmode or gnome.
  HOSTNAME must be defined to different hostnames for each node.
  NICTYPE and WORKER_CLASS must be set to 'tap' in the job group directly in qemu based jobs.
  All jobs with the exception of the parent job must include a PARALLEL_WITH setting
  referencing the parent job.
  And of course, YAML_SCHEDULE must point to this file.
vars:
  # Boot qcow2 image generated by create_hdd_ha_textmode
  BOOT_HDD_IMAGE: '1'
  #DESKTOP: 'textmode' or 'gnome' (hawk)
  HA_CLUSTER: '1'
  HDDMODEL: 'scsi-hd'
  # Disable qemu snapshots to avoid unexpected fences in HA tests
  QEMU_DISABLE_SNAPSHOTS: '1'
  TIMEOUT_SCALE: '2'
  # LVM locking daemon used since SLE 15
  USE_SUPPORT_SERVER: '1'
  VIRTIO_CONSOLE: '1'
  # Below have to be entered in the OpenQA UI because it doesn't read this YAML
  # HDD_1: SLE-%VERSION%-%ARCH%-Build%BUILD%-HA-BV.qcow2
schedule:
  - boot/boot_to_desktop
  - console/system_prepare
  - console/consoletest_setup
  - console/check_os_release
  - console/hostname
  - '{{ctdb}}'
  - '{{hawk}}'
  - '{{cts}}'
conditional_schedule:
  ctdb:
    CTDB_TEST_ROLE:
      client:
        - ha/ctdb
  hawk:
    HAWKGUI_TEST_ROLE:
      client:
        - ha/hawk_gui
  cts:
    PACEMAKER_CTS_TEST_ROLE:
      client:
        - ha/pacemaker_cts_cluster_exerciser
