<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title></title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:none" />
</head>

<body>



<ul id="index">
  <li>
    <ul>
      <li><a href="#save_svirt_pty-save-the-pty-device-within-the-svirt-shell-session-so-that-we-can-refer-to-the-correct-pty-pointing-to-the-first-tty-e.g.-for-password-entry-for-encrypted-partitions-and-rewriting-the-network-definition-of-zKVM-instances">save_svirt_pty save the pty device within the svirt shell session so that we can refer to the correct pty pointing to the first tty, e.g. for password entry for encrypted partitions and rewriting the network definition of zKVM instances.</a></li>
      <li><a href="#integration_services_check_ip-Check-that-guest-IP-address-that-host-and-guest-see-is-the-same">integration_services_check_ip Check that guest IP address that host and guest see is the same.</a></li>
      <li><a href="#integration_services_check-Make-sure-integration-services-e.g.-kernel-modules-utilities-services-are-present-and-in-working-condition">integration_services_check Make sure integration services (e.g. kernel modules, utilities, services) are present and in working condition.</a></li>
      <li><a href="#systemctl-Wrapper-around-systemctl-call-to-be-able-to-add-some-useful-options">systemctl Wrapper around systemctl call to be able to add some useful options.</a></li>
      <li><a href="#workaround_type_encrypted_passphrase">workaround_type_encrypted_passphrase</a></li>
      <li><a href="#set_hostname">set_hostname</a></li>
      <li><a href="#handle_livecd_reboot_failure">handle_livecd_reboot_failure</a></li>
      <li><a href="#assert_screen_with_soft_timeout">assert_screen_with_soft_timeout</a></li>
      <li><a href="#service_action">service_action</a></li>
      <li><a href="#run_scripted_command_slow">run_scripted_command_slow</a></li>
      <li><a href="#get_root_console_tty-Returns-tty-number-used-designed-to-be-used-for-root-console.-When-console-is-not-yet-initialized-we-cannot-get-it-from-arguments.-Since-SLE-15-gdm-is-running-on-tty2-so-we-change-behaviour-for-it-and-openSUSE-distris-except-for-Xen-PV-bsc-1086243">get_root_console_tty Returns tty number used designed to be used for root-console. When console is not yet initialized, we cannot get it from arguments. Since SLE 15 gdm is running on tty2, so we change behaviour for it and openSUSE distris, except for Xen PV (bsc#1086243).</a></li>
      <li><a href="#get_x11_console_tty-Returns-tty-number-used-designed-to-be-used-for-X.-Since-SLE-15-gdm-is-always-running-on-tty7-currently-the-main-GUI-session-is-running-on-tty2-by-default-except-for-Xen-PV-and-Hyper-V-bsc-1086243-.-See-also:-bsc-1054782">get_x11_console_tty Returns tty number used designed to be used for X. Since SLE 15 gdm is always running on tty7, currently the main GUI session is running on tty2 by default, except for Xen PV and Hyper-V (bsc#1086243). See also: bsc#1054782</a></li>
      <li><a href="#arrays_differ-Comparing-two-arrays-passed-by-reference.-Return-1-if-arrays-has-symmetric-difference-and-0-otherwise">arrays_differ Comparing two arrays passed by reference. Return 1 if arrays has symmetric difference and 0 otherwise.</a></li>
      <li><a href="#arrays_subset">arrays_subset</a></li>
      <li><a href="#ensure_serialdev_permissions-Grant-user-permission-to-access-serial-port-immediately-as-well-as-persisting-over-reboots.-Used-to-ensure-that-testapi-calls-like-script_run-work-for-the-test-user-as-well-as-root">ensure_serialdev_permissions Grant user permission to access serial port immediately as well as persisting over reboots. Used to ensure that testapi calls like script_run work for the test user as well as root.</a></li>
      <li><a href="#disable_serial_getty-Serial-getty-service-pollutes-serial-output-with-login-propmt-which-interferes-with-the-output-e.g.-when-calling-script_output.-Login-prompt-messages-on-serial-are-used-on-some-remote-backend-to-identify-that-system-has-been-booted-so-do-not-mask-on-non-qemu-backends">disable_serial_getty Serial getty service pollutes serial output with login propmt, which interferes with the output, e.g. when calling script_output. Login prompt messages on serial are used on some remote backend to identify that system has been booted, so do not mask on non-qemu backends</a></li>
      <li><a href="#exec_and_insert_password">exec_and_insert_password</a></li>
      <li><a href="#shorten_url-Shotren-url-via-schort-s.qa.suse.de-This-is-mainly-used-for-autoyast-url-shorten-to-avoid-limit-of-x3270-xedit">shorten_url Shotren url via schort(s.qa.suse.de) This is mainly used for autoyast url shorten to avoid limit of x3270 xedit</a></li>
      <li><a href="#reconnect_mgmt_console-After-each-reboot-we-have-to-reconnect-to-the-management-console-on-remote-backends">reconnect_mgmt_console After each reboot we have to reconnect to the management console on remote backends</a></li>
      <li><a href="#script_run_interactive">script_run_interactive</a></li>
      <li><a href="#file_content_replace-file_content_replace-filename-regex_to_find-text_to_replace---sed-modifier-g-another-textToFind-replacement">file_content_replace file_content_replace(&quot;filename&quot;, regex_to_find =&gt; text_to_replace, &#39;--sed-modifier&#39; =&gt; &#39;g&#39;, &#39;another^&amp;&amp;*(textToFind&#39; =&gt; &quot;replacement&quot;)</a></li>
    </ul>
  </li>
</ul>

<h2 id="save_svirt_pty-save-the-pty-device-within-the-svirt-shell-session-so-that-we-can-refer-to-the-correct-pty-pointing-to-the-first-tty-e.g.-for-password-entry-for-encrypted-partitions-and-rewriting-the-network-definition-of-zKVM-instances">save_svirt_pty save the pty device within the svirt shell session so that we can refer to the correct pty pointing to the first tty, e.g. for password entry for encrypted partitions and rewriting the network definition of zKVM instances.</h2>

<p>Does not work on Hyper-V.</p>

<h2 id="integration_services_check_ip-Check-that-guest-IP-address-that-host-and-guest-see-is-the-same">integration_services_check_ip Check that guest IP address that host and guest see is the same.</h2>

<h2 id="integration_services_check-Make-sure-integration-services-e.g.-kernel-modules-utilities-services-are-present-and-in-working-condition">integration_services_check Make sure integration services (e.g. kernel modules, utilities, services) are present and in working condition.</h2>

<h2 id="systemctl-Wrapper-around-systemctl-call-to-be-able-to-add-some-useful-options">systemctl Wrapper around systemctl call to be able to add some useful options.</h2>

<p>Please note that return code of this function is handle by &#39;script_run&#39; or &#39;assert_script_run&#39; function, and as such, can be different.</p>

<h2 id="workaround_type_encrypted_passphrase">workaround_type_encrypted_passphrase</h2>

<pre><code>    workaround_type_encrypted_passphrase()</code></pre>

<p>Record soft-failure for unresolved feature fsc#320901 which we think is important and then unlock encrypted boot partitions if we expect it to be encrypted. This condition is met on &#39;storage-ng&#39; which by default puts the boot partition within the encrypted LVM same as in test scenarios where we explicitly create an LVM including boot (<code>FULL_LVM_ENCRYPT</code>). <code>ppc64le</code> was already doing the same by default also in the case of pre-storage-ng but not anymore for storage-ng.</p>

<h2 id="set_hostname">set_hostname</h2>

<pre><code>    set_hostname($hostname);</code></pre>

<p>Setting hostname according input parameter using hostnamectl. Calling <i>reload-or-restart</i> to make sure that network stack will propogate hostname into DHCP/DNS</p>

<p>if you change hostname using <code>hostnamectl set-hostname</code>, then <code>hostname -f</code> will fail with <i>hostname: Name or service not known</i> also DHCP/DNS don&#39;t know about the changed hostname, you need to send a new DHCP request to update dynamic DNS yast2-network module does <code>NetworkService.ReloadOrRestart if Stage.normal || !Linuxrc.usessh</code> if hostname is changed via <code>yast2 lan</code></p>

<h2 id="handle_livecd_reboot_failure">handle_livecd_reboot_failure</h2>

<p>Handle a potential failure on a live CD related to boo#993885 that the reboot action from a desktop session does not work and we are stuck on the desktop.</p>

<h2 id="assert_screen_with_soft_timeout">assert_screen_with_soft_timeout</h2>

<pre><code>  assert_screen_with_soft_timeout($mustmatch [,timeout =&gt; $timeout] [, bugref =&gt; $bugref] [,soft_timeout =&gt; $soft_timeout] [,soft_failure_reason =&gt; $soft_failure_reason]);</code></pre>

<p>Extending assert_screen with a soft timeout. When <code>$soft_timeout</code> is hit, a soft failure is recorded with the message <code>$soft_failure_reason</code> but assert_screen continues until the (hard) timeout <code>$timeout</code> is hit. This makes sense when an assert screen should find a screen within a lower time but still should not fail and continue until the hard timeout, e.g. to discover performance issues.</p>

<p>Example:</p>

<pre><code>  assert_screen_with_soft_timeout(&#39;registration-found&#39;, timeout =&gt; 300, soft_timeout =&gt; 60, bugref =&gt; &#39;bsc#123456&#39;);</code></pre>

<h2 id="service_action">service_action</h2>

<pre><code>  service_action($service_name [, {type =&gt; [&#39;$unit_type&#39;, ...] [,action =&gt; [&#39;$service_action&#39;, ...]]}]);</code></pre>

<p>Control systemd services. <code>type</code> may be set to service, socket, ... and <code>$action</code> to start, stop, ... Default action is to &#39;stop&#39; $service_name.service unit file.</p>

<p>Example:</p>

<pre><code>  service_action(&#39;dbus&#39;, {type =&gt; [&#39;socket&#39;, &#39;service&#39;], action =&gt; [&#39;unmask&#39;, &#39;start&#39;]});</code></pre>

<h2 id="run_scripted_command_slow">run_scripted_command_slow</h2>

<pre><code>    run_scripted_command_slow($cmd [, slow_type =&gt; &lt;num&gt;]);</code></pre>

<p>Type slowly to run very long command in scripted way to avoid issue of &#39;key event queue full&#39; (see poo#12250). Pass optional slow_type key to control how slow to type the command. Scripted very long command to shorten typing length. Default slow_type is type_string_slow.</p>

<h2 id="get_root_console_tty-Returns-tty-number-used-designed-to-be-used-for-root-console.-When-console-is-not-yet-initialized-we-cannot-get-it-from-arguments.-Since-SLE-15-gdm-is-running-on-tty2-so-we-change-behaviour-for-it-and-openSUSE-distris-except-for-Xen-PV-bsc-1086243">get_root_console_tty Returns tty number used designed to be used for root-console. When console is not yet initialized, we cannot get it from arguments. Since SLE 15 gdm is running on tty2, so we change behaviour for it and openSUSE distris, except for Xen PV (bsc#1086243).</h2>

<h2 id="get_x11_console_tty-Returns-tty-number-used-designed-to-be-used-for-X.-Since-SLE-15-gdm-is-always-running-on-tty7-currently-the-main-GUI-session-is-running-on-tty2-by-default-except-for-Xen-PV-and-Hyper-V-bsc-1086243-.-See-also:-bsc-1054782">get_x11_console_tty Returns tty number used designed to be used for X. Since SLE 15 gdm is always running on tty7, currently the main GUI session is running on tty2 by default, except for Xen PV and Hyper-V (bsc#1086243). See also: bsc#1054782</h2>

<h2 id="arrays_differ-Comparing-two-arrays-passed-by-reference.-Return-1-if-arrays-has-symmetric-difference-and-0-otherwise">arrays_differ Comparing two arrays passed by reference. Return 1 if arrays has symmetric difference and 0 otherwise.</h2>

<h2 id="arrays_subset">arrays_subset</h2>

<pre><code>    arrays_subset(\@array1, \@array2);</code></pre>

<p>Compares two arrays passed by reference to identify if array1 is a subset of array2.</p>

<p>Returns resulting array containing items of array1 that do not exist in array2. If all the items of array1 exist in array2, returns an empty array (which means array1 is a subset of array2).</p>

<h2 id="ensure_serialdev_permissions-Grant-user-permission-to-access-serial-port-immediately-as-well-as-persisting-over-reboots.-Used-to-ensure-that-testapi-calls-like-script_run-work-for-the-test-user-as-well-as-root">ensure_serialdev_permissions Grant user permission to access serial port immediately as well as persisting over reboots. Used to ensure that testapi calls like script_run work for the test user as well as root.</h2>

<h2 id="disable_serial_getty-Serial-getty-service-pollutes-serial-output-with-login-propmt-which-interferes-with-the-output-e.g.-when-calling-script_output.-Login-prompt-messages-on-serial-are-used-on-some-remote-backend-to-identify-that-system-has-been-booted-so-do-not-mask-on-non-qemu-backends">disable_serial_getty Serial getty service pollutes serial output with login propmt, which interferes with the output, e.g. when calling script_output. Login prompt messages on serial are used on some remote backend to identify that system has been booted, so do not mask on non-qemu backends</h2>

<h2 id="exec_and_insert_password">exec_and_insert_password</h2>

<pre><code>    exec_and_insert_password($cmd);

 1. Execute a command that ask for a password
 2. Detects password prompt
 3. Insert password and hits enter</code></pre>

<h2 id="shorten_url-Shotren-url-via-schort-s.qa.suse.de-This-is-mainly-used-for-autoyast-url-shorten-to-avoid-limit-of-x3270-xedit">shorten_url Shotren url via schort(s.qa.suse.de) This is mainly used for autoyast url shorten to avoid limit of x3270 xedit</h2>

<h2 id="reconnect_mgmt_console-After-each-reboot-we-have-to-reconnect-to-the-management-console-on-remote-backends">reconnect_mgmt_console After each reboot we have to reconnect to the management console on remote backends</h2>

<h2 id="script_run_interactive">script_run_interactive</h2>

<pre><code>    script_run_interactive($cmd, $prompt, $timeout);</code></pre>

<p>For interactive command, input strings or keys according to the prompt message in the run time. Pass arrayref $prompt which contains the prompt message to be matched (regex) and the answer with string or key to be typed. for example:</p>

<pre><code>    [{
        prompt =&gt; qr/\(A\)llow/m,
        key    =&gt; &#39;a&#39;,
      },
      {
        prompt =&gt; qr/Enter Password or Pin/m,
        string =&gt; &quot;testpasspw\n&quot;,
      },]</code></pre>

<p>A &quot;EOS~~~&quot; message followed by return value will be printed as a mark for the end of interaction after the command finished running.</p>

<p>If the first argument is undef, only the sencond part will be processed - to match output and react. If the second argument is undef, the first part will be processed - to run the command without interaction with terminal output. This is useful for some situation when you want to do more between inputing command and the following interaction, eg. switch TTYs or detach the screen.</p>

<h2 id="file_content_replace-file_content_replace-filename-regex_to_find-text_to_replace---sed-modifier-g-another-textToFind-replacement">file_content_replace file_content_replace(&quot;filename&quot;, regex_to_find =&gt; text_to_replace, &#39;--sed-modifier&#39; =&gt; &#39;g&#39;, &#39;another^&amp;&amp;*(textToFind&#39; =&gt; &quot;replacement&quot;)</h2>

<pre><code>  generify sed usage as config file modification tool.
  allow to modify several items in one function call 
  by providing  regex_to_find / text_to_replace as hash key/value pairs

  special key &#39;--sed-modifier&#39; allowing to add modifiers to expression</code></pre>


</body>

</html>


