#!/bin/bash

tmpfile=$(mktemp)
grep -B 1000 "^# BEGIN AUTOGENERATED DEPENDENCY LIST" os-autoinst-distri-opensuse-deps.spec >> $tmpfile
grep ^requires cpanfile | cut -d"'" -f2 | while read dep ; do echo "Requires:       perl($dep)" ; done | sort -fi >> $tmpfile
grep -A 1000 "^# END AUTOGENERATED DEPENDENCY LIST" os-autoinst-distri-opensuse-deps.spec >> $tmpfile
if [[ "$1" == "--check" ]] && ! diff -u os-autoinst-distri-opensuse-deps.spec $tmpfile ; then
	echo -e "\nERROR: cpanfile and specfile out of sync - run ./tools/update_spec and follow instructions in cpanfile!"
	exit 1
fi
mv $tmpfile os-autoinst-distri-opensuse-deps.spec
